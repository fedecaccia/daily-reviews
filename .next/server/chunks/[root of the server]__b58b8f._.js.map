{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 223, "column": 0}, "map": {"version":3,"sources":["file:///Users/federicocaccia/code/daily-review/src/app/api/lib/spreadsheet.ts"],"sourcesContent":["import { GoogleSpreadsheet } from 'google-spreadsheet';\nimport { JWT } from 'google-auth-library';\n\nlet doc: GoogleSpreadsheet;\n\nconst HEADERS = [\n  'date',\n  'workout_abs',\n  'workout_chest',\n  'workout_back',\n  'workout_shoulders',\n  'workout_biceps',\n  'workout_triceps',\n  'workout_legs',\n  'workout_stretching',\n  'workout_aerobic',\n  'relax_yoga',\n  'relax_meditation',\n  'health_sleep_seven',\n  'health_acidity',\n  'productivity_level',\n  'productivity_reading',\n  'nutrition_fruits',\n  'nutrition_polyphenols',\n  'nutrition_heavy_food',\n  'nutrition_fast_food',\n  'nutrition_yogurt',\n  'life_couple_discussions',\n  'life_gaming',\n  'notes'\n];\n\n// Inicializar la conexión\nasync function initializeSheet() {\n  if (!doc) {\n    try {\n      const SCOPES = [\n        'https://www.googleapis.com/auth/spreadsheets',\n      ];\n\n      const jwt = new JWT({\n        email: process.env.GOOGLE_SHEETS_CLIENT_EMAIL,\n        key: process.env.GOOGLE_SHEETS_PRIVATE_KEY?.replace(/\\\\n/g, '\\n'),\n        scopes: SCOPES,\n      });\n\n      doc = new GoogleSpreadsheet(process.env.GOOGLE_SHEETS_SPREADSHEET_ID!, jwt);\n      await doc.loadInfo();\n\n      // Obtener la primera hoja\n      const sheet = doc.sheetsByIndex[0];\n      \n      try {\n        // Intentar cargar los headers existentes\n        await sheet.loadHeaderRow();\n      } catch (error) {\n        console.error('Error loading headers:', error);\n        // Si no hay headers, los establecemos\n        await sheet.setHeaderRow(HEADERS);\n      }\n    } catch (error) {\n      console.error('Error initializing spreadsheet:', error);\n      throw new Error(`Failed to initialize spreadsheet: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n}\n\nexport async function updateField(date: string, sectionId: string, fieldId: string, value: string | number | boolean) {\n  await initializeSheet();\n  const sheet = doc.sheetsByIndex[0];\n  \n  const rows = await sheet.getRows();\n  const rowIndex = rows.findIndex(row => row.get('date') === date);\n  \n  if (rowIndex === -1) {\n    // Si no existe la fila, la creamos\n    await sheet.addRow({\n      date,\n      [`${sectionId}_${fieldId}`]: value\n    });\n  } else {\n    // Si existe, actualizamos el campo específico\n    rows[rowIndex].set(`${sectionId}_${fieldId}`, value);\n    await rows[rowIndex].save();\n  }\n}\n\nexport async function updateNotes(date: string, notes: string) {\n  await initializeSheet();\n  const sheet = doc.sheetsByIndex[0];\n  \n  const rows = await sheet.getRows();\n  const rowIndex = rows.findIndex(row => row.get('date') === date);\n  \n  if (rowIndex === -1) {\n    await sheet.addRow({\n      date,\n      notes\n    });\n  } else {\n    rows[rowIndex].set('notes', notes);\n    await rows[rowIndex].save();\n  }\n}\n\ninterface DayData {\n  [key: string]: string | number | boolean;\n}\n\nexport async function loadDayData(date: string): Promise<DayData | null> {\n  await initializeSheet();\n  const sheet = doc.sheetsByIndex[0];\n  \n  const rows = await sheet.getRows();\n  const row = rows.find(row => row.get('date') === date);\n  \n  if (!row) return null;\n\n  // Convertir la fila a un objeto con todos los campos\n  const data: DayData = {};\n  HEADERS.forEach(header => {\n    const value = row.get(header);\n    \n    if (header === 'notes') {\n      // Para las notas, guardamos el valor directo sin procesar\n      data[header] = value || '';\n      console.log('Notes loaded:', value); // Debug\n    } else if (header === 'date') {\n      // Para la fecha, guardamos el string directo\n      data[header] = value;\n    } else {\n      // Para el resto de campos\n      if (value === 'TRUE' || value === 'true') {\n        data[header] = true;\n      } else if (value === 'FALSE' || value === 'false') {\n        data[header] = false;\n      } else if (!isNaN(Number(value)) && value !== '') {\n        data[header] = Number(value);\n      } else {\n        data[header] = value || '';\n      }\n    }\n  });\n  \n  console.log('Full loaded data:', data); // Para debugging\n  return data;\n} "],"names":[],"mappings":"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"}},
    {"offset": {"line": 354, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 368, "column": 0}, "map": {"version":3,"sources":["file:///Users/federicocaccia/code/daily-review/src/app/api/load-data/route.ts"],"sourcesContent":["import { loadDayData } from '../lib/spreadsheet';\nimport { NextResponse } from 'next/server';\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const date = searchParams.get('date');\n\n    if (!date) {\n      return NextResponse.json({ error: 'Date parameter is required' }, { status: 400 });\n    }\n\n    // Verificar que las variables de entorno estén definidas\n    const requiredEnvVars = [\n      'GOOGLE_SHEETS_PRIVATE_KEY',\n      'GOOGLE_SHEETS_CLIENT_EMAIL',\n      'GOOGLE_SHEETS_SPREADSHEET_ID'\n    ];\n\n    const missingEnvVars = requiredEnvVars.filter(varName => !process.env[varName]);\n    if (missingEnvVars.length > 0) {\n      console.error('Missing environment variables:', missingEnvVars);\n      return NextResponse.json({\n        error: 'Configuration error',\n        details: `Missing environment variables: ${missingEnvVars.join(', ')}`\n      }, { status: 500 });\n    }\n\n    // Log de las variables de entorno (sin mostrar valores completos por seguridad)\n    console.log('Environment variables status:', {\n      PRIVATE_KEY: process.env.GOOGLE_SHEETS_PRIVATE_KEY?.slice(0, 20) + '...',\n      CLIENT_EMAIL: process.env.GOOGLE_SHEETS_CLIENT_EMAIL?.slice(0, 10) + '...',\n      SPREADSHEET_ID: process.env.GOOGLE_SHEETS_SPREADSHEET_ID?.slice(0, 10) + '...'\n    });\n\n    const data = await loadDayData(date);\n    \n    if (!data) {\n      return NextResponse.json({ \n        error: 'No data found',\n        details: `No data found for date: ${date}`\n      }, { status: 404 });\n    }\n\n    return NextResponse.json(data);\n  } catch (error) {\n    console.error('Load data error:', error);\n    \n    // Mejorar el mensaje de error\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n    const errorStack = error instanceof Error ? error.stack : undefined;\n\n    return NextResponse.json({\n      error: 'Failed to load data',\n      details: errorMessage,\n      stack: process.env.NODE_ENV === 'development' ? errorStack : undefined,\n      timestamp: new Date().toISOString()\n    }, { status: 500 });\n  }\n} "],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;QAE9B,IAAI,CAAC,MAAM;YACT,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,yDAAyD;QACzD,MAAM,kBAAkB;YACtB;YACA;YACA;SACD;QAED,MAAM,iBAAiB,gBAAgB,MAAM,CAAC,CAAA,UAAW,CAAC,QAAQ,GAAG,CAAC,QAAQ;QAC9E,IAAI,eAAe,MAAM,GAAG,GAAG;YAC7B,QAAQ,KAAK,CAAC,kCAAkC;YAChD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;gBACP,SAAS,CAAC,+BAA+B,EAAE,eAAe,IAAI,CAAC,OAAO;YACxE,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,gFAAgF;QAChF,QAAQ,GAAG,CAAC,iCAAiC;YAC3C,aAAa,QAAQ,GAAG,CAAC,yBAAyB,EAAE,MAAM,GAAG,MAAM;YACnE,cAAc,QAAQ,GAAG,CAAC,0BAA0B,EAAE,MAAM,GAAG,MAAM;YACrE,gBAAgB,QAAQ,GAAG,CAAC,4BAA4B,EAAE,MAAM,GAAG,MAAM;QAC3E;QAEA,MAAM,OAAO,MAAM,CAAA,GAAA,yIAAA,CAAA,cAAW,AAAD,EAAE;QAE/B,IAAI,CAAC,MAAM;YACT,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;gBACP,SAAS,CAAC,wBAAwB,EAAE,MAAM;YAC5C,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAElC,8BAA8B;QAC9B,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,MAAM,aAAa,iBAAiB,QAAQ,MAAM,KAAK,GAAG;QAE1D,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,SAAS;YACT,OAAO,uCAAyC;YAChD,WAAW,IAAI,OAAO,WAAW;QACnC,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}},
    {"offset": {"line": 433, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}