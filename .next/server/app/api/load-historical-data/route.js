"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/load-historical-data/route";
exports.ids = ["app/api/load-historical-data/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:events":
/*!******************************!*\
  !*** external "node:events" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:events");

/***/ }),

/***/ "node:process":
/*!*******************************!*\
  !*** external "node:process" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("node:process");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-historical-data%2Froute&page=%2Fapi%2Fload-historical-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-historical-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-historical-data%2Froute&page=%2Fapi%2Fload-historical-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-historical-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_federicocaccia_code_daily_review_src_app_api_load_historical_data_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/load-historical-data/route.ts */ \"(rsc)/./src/app/api/load-historical-data/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/load-historical-data/route\",\n        pathname: \"/api/load-historical-data\",\n        filename: \"route\",\n        bundlePath: \"app/api/load-historical-data/route\"\n    },\n    resolvedPagePath: \"/Users/federicocaccia/code/daily-review/src/app/api/load-historical-data/route.ts\",\n    nextConfigOutput,\n    userland: _Users_federicocaccia_code_daily_review_src_app_api_load_historical_data_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/load-historical-data/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZsb2FkLWhpc3RvcmljYWwtZGF0YSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGbG9hZC1oaXN0b3JpY2FsLWRhdGElMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZsb2FkLWhpc3RvcmljYWwtZGF0YSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmZlZGVyaWNvY2FjY2lhJTJGY29kZSUyRmRhaWx5LXJldmlldyUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZmZWRlcmljb2NhY2NpYSUyRmNvZGUlMkZkYWlseS1yZXZpZXcmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2lDO0FBQzlHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGFpbHktcmV2aWV3Lz81YjU4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9mZWRlcmljb2NhY2NpYS9jb2RlL2RhaWx5LXJldmlldy9zcmMvYXBwL2FwaS9sb2FkLWhpc3RvcmljYWwtZGF0YS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvbG9hZC1oaXN0b3JpY2FsLWRhdGEvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9sb2FkLWhpc3RvcmljYWwtZGF0YVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbG9hZC1oaXN0b3JpY2FsLWRhdGEvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvZmVkZXJpY29jYWNjaWEvY29kZS9kYWlseS1yZXZpZXcvc3JjL2FwcC9hcGkvbG9hZC1oaXN0b3JpY2FsLWRhdGEvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2xvYWQtaGlzdG9yaWNhbC1kYXRhL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-historical-data%2Froute&page=%2Fapi%2Fload-historical-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-historical-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/lib/spreadsheet.ts":
/*!****************************************!*\
  !*** ./src/app/api/lib/spreadsheet.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   HEADERS: () => (/* binding */ HEADERS),\n/* harmony export */   ensureAndLoadDay: () => (/* binding */ ensureAndLoadDay),\n/* harmony export */   ensureDayExists: () => (/* binding */ ensureDayExists),\n/* harmony export */   updateField: () => (/* binding */ updateField),\n/* harmony export */   updateNotes: () => (/* binding */ updateNotes)\n/* harmony export */ });\n/* harmony import */ var google_spreadsheet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! google-spreadsheet */ \"(rsc)/./node_modules/google-spreadsheet/dist/index.mjs\");\n/* harmony import */ var google_auth_library__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! google-auth-library */ \"(rsc)/./node_modules/google-auth-library/build/src/index.js\");\n\n\n// Constantes\nconst MAX_RETRIES = 3;\nconst RETRY_DELAY = 1000; // ms\nconst OPERATION_TIMEOUT = 1000; // 5 segundos máximo por operación\nconst RATE_LIMIT_DELAY = 1000; // Aumentado a 5 segundos entre operaciones\n// Cache de conexión y datos\nlet cachedDoc = null;\nlet lastRequestTime = 0;\nlet cachedRows = null;\nlet lastRowsFetch = 0;\nconst CACHE_TTL = 5000; // Aumentado a 5 segundos de TTL para el cache\nconst ROW_CACHE = {}; // Cache para filas individuales\nasync function waitForRateLimit() {\n    const now = Date.now();\n    const timeSinceLastRequest = now - lastRequestTime;\n    if (timeSinceLastRequest < RATE_LIMIT_DELAY) {\n        await wait(RATE_LIMIT_DELAY - timeSinceLastRequest);\n    }\n    lastRequestTime = Date.now();\n}\nasync function ensureHeaders(sheet) {\n    try {\n        // Primero cargar la hoja\n        await sheet.loadHeaderRow();\n        const headerValues = sheet.headerValues;\n        // Verificar qué headers faltan\n        const missingHeaders = HEADERS.filter((header)=>!headerValues.includes(header));\n        if (missingHeaders.length > 0) {\n            console.log(\"Adding new headers at the end:\", missingHeaders);\n            // Calcular el número total de columnas necesarias\n            const totalColumns = headerValues.length + missingHeaders.length;\n            // Redimensionar la hoja si es necesario\n            if (sheet.columnCount < totalColumns) {\n                console.log(`Resizing sheet from ${sheet.columnCount} to ${totalColumns} columns`);\n                await sheet.resize({\n                    columnCount: totalColumns\n                });\n            }\n            // Agregar los headers faltantes al final\n            const newHeaders = [\n                ...headerValues,\n                ...missingHeaders\n            ];\n            await sheet.setHeaderRow(newHeaders);\n        }\n    } catch (error) {\n        console.error(\"Error ensuring headers:\", error);\n        throw error;\n    }\n}\nasync function getSpreadsheetConnection() {\n    try {\n        // Si ya tenemos una conexión cacheada, verificar que siga siendo válida\n        if (cachedDoc) {\n            try {\n                await cachedDoc.loadInfo();\n                return cachedDoc;\n            } catch (error) {\n                console.log(\"Cached connection invalid, creating new one\");\n                cachedDoc = null;\n            }\n        }\n        const SCOPES = [\n            \"https://www.googleapis.com/auth/spreadsheets\"\n        ];\n        const jwt = new google_auth_library__WEBPACK_IMPORTED_MODULE_1__.JWT({\n            email: process.env.GOOGLE_SHEETS_CLIENT_EMAIL,\n            key: process.env.GOOGLE_SHEETS_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\"),\n            scopes: SCOPES\n        });\n        const doc = new google_spreadsheet__WEBPACK_IMPORTED_MODULE_0__.GoogleSpreadsheet(process.env.GOOGLE_SHEETS_SPREADSHEET_ID, jwt);\n        await doc.loadInfo(); // Asegurarnos de que el documento está cargado\n        // Asegurarnos de que existan todas las columnas necesarias\n        const sheet = doc.sheetsByIndex[0];\n        await ensureHeaders(sheet);\n        // Solo cachear después de que todo esté correctamente inicializado\n        cachedDoc = doc;\n        return doc;\n    } catch (error) {\n        cachedDoc = null;\n        console.error(\"Error getting spreadsheet connection:\", error);\n        throw error;\n    }\n}\nasync function getSheetRows(sheet) {\n    const now = Date.now();\n    if (cachedRows && now - lastRowsFetch < CACHE_TTL) {\n        return cachedRows;\n    }\n    await waitForRateLimit();\n    cachedRows = await sheet.getRows();\n    lastRowsFetch = now;\n    return cachedRows;\n}\nconst wait = (ms)=>new Promise((resolve)=>setTimeout(resolve, ms));\n// Función para ejecutar una operación con timeout\nasync function withTimeout(operation) {\n    const timeoutPromise = new Promise((_, reject)=>{\n        setTimeout(()=>reject(new Error(\"Operation timed out\")), OPERATION_TIMEOUT);\n    });\n    return Promise.race([\n        operation(),\n        timeoutPromise\n    ]);\n}\nasync function withRetry(operation) {\n    let lastError;\n    for(let attempt = 1; attempt <= MAX_RETRIES; attempt++){\n        try {\n            return await operation();\n        } catch (error) {\n            lastError = error;\n            console.error(`Attempt ${attempt} failed:`, error);\n            if (attempt === MAX_RETRIES) throw error;\n            // Si es un error de rate limit, esperamos más tiempo\n            const delay = error.status === 429 ? RETRY_DELAY * Math.pow(2, attempt + 1) // Más tiempo para rate limits\n             : RETRY_DELAY * Math.pow(2, attempt - 1); // Tiempo normal para otros errores\n            await wait(delay);\n        }\n    }\n    throw lastError;\n}\nconst HEADERS = [\n    \"date\",\n    \"workout_running\",\n    \"workout_swimming\",\n    \"workout_abs\",\n    \"workout_chest\",\n    \"workout_back\",\n    \"workout_shoulders\",\n    \"workout_biceps\",\n    \"workout_triceps\",\n    \"workout_legs\",\n    \"workout_stretching\",\n    \"workout_aerobic\",\n    \"relax_yoga\",\n    \"relax_meditation\",\n    \"relax_tea\",\n    \"health_sleep_seven\",\n    \"health_acidity\",\n    \"health_systolic\",\n    \"health_diastolic\",\n    \"health_headache\",\n    \"habits_nail_biting\",\n    \"habits_posture\",\n    \"productivity_level\",\n    \"productivity_reading_time\",\n    \"nutrition_fruits\",\n    \"nutrition_polyphenols\",\n    \"nutrition_heavy_food\",\n    \"nutrition_fast_food\",\n    \"nutrition_yogurt\",\n    \"life_couple_discussions\",\n    \"life_gaming\",\n    \"notes\"\n];\n// Mapa de tipos de campos\nconst FIELD_TYPES = {\n    \"workout_running\": \"minutes\",\n    \"workout_swimming\": \"minutes\",\n    \"workout_abs\": \"boolean\",\n    \"workout_chest\": \"boolean\",\n    \"workout_back\": \"boolean\",\n    \"workout_shoulders\": \"boolean\",\n    \"workout_biceps\": \"boolean\",\n    \"workout_triceps\": \"boolean\",\n    \"workout_legs\": \"boolean\",\n    \"workout_stretching\": \"boolean\",\n    \"workout_aerobic\": \"boolean\",\n    \"relax_yoga\": \"boolean\",\n    \"relax_meditation\": \"boolean\",\n    \"relax_tea\": \"boolean\",\n    \"health_sleep_seven\": \"boolean\",\n    \"health_acidity\": \"boolean\",\n    \"health_systolic\": \"minutes\",\n    \"health_diastolic\": \"minutes\",\n    \"health_headache\": \"boolean\",\n    \"habits_nail_biting\": \"boolean\",\n    \"habits_posture\": \"boolean\",\n    \"productivity_level\": \"slider\",\n    \"productivity_reading_time\": \"minutes\",\n    \"nutrition_fruits\": \"minutes\",\n    \"nutrition_polyphenols\": \"boolean\",\n    \"nutrition_heavy_food\": \"boolean\",\n    \"nutrition_fast_food\": \"boolean\",\n    \"nutrition_yogurt\": \"boolean\",\n    \"life_couple_discussions\": \"slider\",\n    \"life_gaming\": \"boolean\",\n    \"notes\": \"text\"\n};\nasync function updateField(date, sectionId, fieldId, value) {\n    return withRetry(async ()=>{\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        // Una sola lectura para encontrar o crear la fila\n        const rows = await sheet.getRows();\n        if (!rows) {\n            throw new Error(\"Failed to get sheet rows\");\n        }\n        const rowIndex = rows.findIndex((row)=>row.get(\"date\") === date);\n        const fieldKey = `${sectionId}_${fieldId}`;\n        try {\n            if (rowIndex === -1) {\n                // Si no existe la fila, la creamos con TODOS los campos inicializados\n                const newRow = {\n                    date\n                };\n                // Inicializar todos los campos con sus valores por defecto según su tipo\n                HEADERS.forEach((header)=>{\n                    if (header === \"date\") return; // Skip date as it's already set\n                    const fieldType = FIELD_TYPES[header];\n                    switch(fieldType){\n                        case \"boolean\":\n                            newRow[header] = \"FALSE\";\n                            break;\n                        case \"minutes\":\n                            newRow[header] = \"0\";\n                            break;\n                        case \"slider\":\n                            newRow[header] = \"1\";\n                            break;\n                        case \"text\":\n                            newRow[header] = \"\";\n                            break;\n                    }\n                });\n                // Actualizar el campo específico con el valor proporcionado\n                newRow[fieldKey] = typeof value === \"boolean\" ? value.toString().toUpperCase() : value.toString();\n                // Solo una escritura para crear la fila\n                await sheet.addRow(newRow);\n            } else {\n                // Si existe, actualizamos solo el campo específico\n                const formattedValue = typeof value === \"boolean\" ? value.toString().toUpperCase() : value.toString();\n                rows[rowIndex].set(fieldKey, formattedValue);\n                // Solo una escritura para actualizar el campo\n                await rows[rowIndex].save();\n            }\n        } catch (error) {\n            console.error(\"Error in updateField operation:\", {\n                error,\n                date,\n                sectionId,\n                fieldId,\n                value,\n                fieldKey\n            });\n            throw error;\n        }\n    });\n}\nasync function updateNotes(date, notes) {\n    return withRetry(async ()=>{\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        const rows = await sheet.getRows();\n        const rowIndex = rows.findIndex((row)=>row.get(\"date\") === date);\n        if (rowIndex === -1) {\n            // Si no existe la fila, la creamos con TODOS los campos inicializados\n            const newRow = {\n                date\n            };\n            // Inicializar todos los campos con sus valores por defecto según su tipo\n            HEADERS.forEach((header)=>{\n                if (header === \"date\") return; // Skip date as it's already set\n                const fieldType = FIELD_TYPES[header];\n                switch(fieldType){\n                    case \"boolean\":\n                        newRow[header] = \"FALSE\";\n                        break;\n                    case \"minutes\":\n                        newRow[header] = \"0\";\n                        break;\n                    case \"slider\":\n                        newRow[header] = \"1\";\n                        break;\n                    case \"text\":\n                        newRow[header] = header === \"notes\" ? notes : \"\";\n                        break;\n                }\n            });\n            await sheet.addRow(newRow);\n        } else {\n            rows[rowIndex].set(\"notes\", notes);\n            await rows[rowIndex].save();\n        }\n    });\n}\nasync function ensureAndLoadDay(date) {\n    return withRetry(async ()=>{\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        // Intentar cargar la fila existente\n        const rows = await sheet.getRows();\n        const existingRow = rows?.find((row)=>row.get(\"date\") === date);\n        if (existingRow) {\n            // Si la fila existe, convertir los valores según su tipo\n            const data = {};\n            HEADERS.forEach((header)=>{\n                const value = existingRow.get(header);\n                const fieldType = FIELD_TYPES[header];\n                switch(fieldType){\n                    case \"boolean\":\n                        data[header] = value?.toLowerCase() === \"true\";\n                        break;\n                    case \"minutes\":\n                    case \"slider\":\n                        data[header] = parseInt(value || \"0\", 10);\n                        break;\n                    default:\n                        data[header] = value || \"\";\n                }\n            });\n            return data;\n        }\n        // Si no existe, crear una nueva fila con valores por defecto\n        const newRow = {\n            date\n        };\n        HEADERS.forEach((header)=>{\n            if (header === \"date\") return;\n            const fieldType = FIELD_TYPES[header];\n            switch(fieldType){\n                case \"boolean\":\n                    newRow[header] = false;\n                    break;\n                case \"minutes\":\n                case \"slider\":\n                    newRow[header] = 0;\n                    break;\n                default:\n                    newRow[header] = \"\";\n            }\n        });\n        // Agregar la nueva fila\n        await sheet.addRow(newRow);\n        return newRow;\n    });\n}\nasync function ensureDayExists(date) {\n    return withRetry(async ()=>{\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        // Intentar cargar la fila existente\n        const rows = await sheet.getRows();\n        const existingRow = rows?.find((row)=>row.get(\"date\") === date);\n        if (!existingRow) {\n            // Si no existe, crear una nueva fila con valores por defecto\n            const newRow = {\n                date\n            };\n            HEADERS.forEach((header)=>{\n                if (header === \"date\") return;\n                const fieldType = FIELD_TYPES[header];\n                switch(fieldType){\n                    case \"boolean\":\n                        newRow[header] = false;\n                        break;\n                    case \"minutes\":\n                    case \"slider\":\n                        newRow[header] = 0;\n                        break;\n                    default:\n                        newRow[header] = \"\";\n                }\n            });\n            // Agregar la nueva fila\n            await sheet.addRow(newRow);\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGVBQWVpQixnQkFBZ0IzQixJQUFZO0lBQ2hELE9BQU9ULFVBQVU7UUFDZixNQUFNaEIsTUFBTSxNQUFNWjtRQUNsQixNQUFNakIsUUFBUTZCLElBQUlFLGFBQWEsQ0FBQyxFQUFFO1FBRWxDLG9DQUFvQztRQUNwQyxNQUFNMkIsT0FBTyxNQUFNMUQsTUFBTWlDLE9BQU87UUFDaEMsTUFBTTJDLGNBQWNsQixNQUFNbUIsS0FBS2hCLENBQUFBLE1BQU9BLElBQUlDLEdBQUcsQ0FBQyxZQUFZUjtRQUUxRCxJQUFJLENBQUNzQixhQUFhO1lBQ2hCLDZEQUE2RDtZQUM3RCxNQUFNWixTQUE4QjtnQkFBRVY7WUFBSztZQUMzQ2xELFFBQVE2RCxPQUFPLENBQUMzRCxDQUFBQTtnQkFDZCxJQUFJQSxXQUFXLFFBQVE7Z0JBRXZCLE1BQU00RCxZQUFZZCxXQUFXLENBQUM5QyxPQUFPO2dCQUNyQyxPQUFRNEQ7b0JBQ04sS0FBSzt3QkFDSEYsTUFBTSxDQUFDMUQsT0FBTyxHQUFHO3dCQUNqQjtvQkFDRixLQUFLO29CQUNMLEtBQUs7d0JBQ0gwRCxNQUFNLENBQUMxRCxPQUFPLEdBQUc7d0JBQ2pCO29CQUNGO3dCQUNFMEQsTUFBTSxDQUFDMUQsT0FBTyxHQUFHO2dCQUNyQjtZQUNGO1lBRUEsd0JBQXdCO1lBQ3hCLE1BQU1OLE1BQU1xRSxNQUFNLENBQUNMO1FBQ3JCO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2RhaWx5LXJldmlldy8uL3NyYy9hcHAvYXBpL2xpYi9zcHJlYWRzaGVldC50cz80M2Q3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdvb2dsZVNwcmVhZHNoZWV0IH0gZnJvbSAnZ29vZ2xlLXNwcmVhZHNoZWV0JztcbmltcG9ydCB7IEpXVCB9IGZyb20gJ2dvb2dsZS1hdXRoLWxpYnJhcnknO1xuXG4vLyBDb25zdGFudGVzXG5jb25zdCBNQVhfUkVUUklFUyA9IDM7XG5jb25zdCBSRVRSWV9ERUxBWSA9IDEwMDA7IC8vIG1zXG5jb25zdCBPUEVSQVRJT05fVElNRU9VVCA9IDEwMDA7IC8vIDUgc2VndW5kb3MgbcOheGltbyBwb3Igb3BlcmFjacOzblxuY29uc3QgUkFURV9MSU1JVF9ERUxBWSA9IDEwMDA7IC8vIEF1bWVudGFkbyBhIDUgc2VndW5kb3MgZW50cmUgb3BlcmFjaW9uZXNcblxuLy8gQ2FjaGUgZGUgY29uZXhpw7NuIHkgZGF0b3NcbmxldCBjYWNoZWREb2M6IEdvb2dsZVNwcmVhZHNoZWV0IHwgbnVsbCA9IG51bGw7XG5sZXQgbGFzdFJlcXVlc3RUaW1lID0gMDtcbmxldCBjYWNoZWRSb3dzOiBhbnlbXSB8IG51bGwgPSBudWxsO1xubGV0IGxhc3RSb3dzRmV0Y2ggPSAwO1xuY29uc3QgQ0FDSEVfVFRMID0gNTAwMDsgLy8gQXVtZW50YWRvIGEgNSBzZWd1bmRvcyBkZSBUVEwgcGFyYSBlbCBjYWNoZVxuY29uc3QgUk9XX0NBQ0hFOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307IC8vIENhY2hlIHBhcmEgZmlsYXMgaW5kaXZpZHVhbGVzXG5cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JSYXRlTGltaXQoKSB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGNvbnN0IHRpbWVTaW5jZUxhc3RSZXF1ZXN0ID0gbm93IC0gbGFzdFJlcXVlc3RUaW1lO1xuICBcbiAgaWYgKHRpbWVTaW5jZUxhc3RSZXF1ZXN0IDwgUkFURV9MSU1JVF9ERUxBWSkge1xuICAgIGF3YWl0IHdhaXQoUkFURV9MSU1JVF9ERUxBWSAtIHRpbWVTaW5jZUxhc3RSZXF1ZXN0KTtcbiAgfVxuICBcbiAgbGFzdFJlcXVlc3RUaW1lID0gRGF0ZS5ub3coKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZW5zdXJlSGVhZGVycyhzaGVldDogYW55KSB7XG4gIHRyeSB7XG4gICAgLy8gUHJpbWVybyBjYXJnYXIgbGEgaG9qYVxuICAgIGF3YWl0IHNoZWV0LmxvYWRIZWFkZXJSb3coKTtcbiAgICBjb25zdCBoZWFkZXJWYWx1ZXMgPSBzaGVldC5oZWFkZXJWYWx1ZXM7XG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIHF1w6kgaGVhZGVycyBmYWx0YW5cbiAgICBjb25zdCBtaXNzaW5nSGVhZGVycyA9IEhFQURFUlMuZmlsdGVyKGhlYWRlciA9PiAhaGVhZGVyVmFsdWVzLmluY2x1ZGVzKGhlYWRlcikpO1xuICAgIFxuICAgIGlmIChtaXNzaW5nSGVhZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zb2xlLmxvZygnQWRkaW5nIG5ldyBoZWFkZXJzIGF0IHRoZSBlbmQ6JywgbWlzc2luZ0hlYWRlcnMpO1xuICAgICAgXG4gICAgICAvLyBDYWxjdWxhciBlbCBuw7ptZXJvIHRvdGFsIGRlIGNvbHVtbmFzIG5lY2VzYXJpYXNcbiAgICAgIGNvbnN0IHRvdGFsQ29sdW1ucyA9IGhlYWRlclZhbHVlcy5sZW5ndGggKyBtaXNzaW5nSGVhZGVycy5sZW5ndGg7XG4gICAgICBcbiAgICAgIC8vIFJlZGltZW5zaW9uYXIgbGEgaG9qYSBzaSBlcyBuZWNlc2FyaW9cbiAgICAgIGlmIChzaGVldC5jb2x1bW5Db3VudCA8IHRvdGFsQ29sdW1ucykge1xuICAgICAgICBjb25zb2xlLmxvZyhgUmVzaXppbmcgc2hlZXQgZnJvbSAke3NoZWV0LmNvbHVtbkNvdW50fSB0byAke3RvdGFsQ29sdW1uc30gY29sdW1uc2ApO1xuICAgICAgICBhd2FpdCBzaGVldC5yZXNpemUoeyBjb2x1bW5Db3VudDogdG90YWxDb2x1bW5zIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZ3JlZ2FyIGxvcyBoZWFkZXJzIGZhbHRhbnRlcyBhbCBmaW5hbFxuICAgICAgY29uc3QgbmV3SGVhZGVycyA9IFsuLi5oZWFkZXJWYWx1ZXMsIC4uLm1pc3NpbmdIZWFkZXJzXTtcbiAgICAgIGF3YWl0IHNoZWV0LnNldEhlYWRlclJvdyhuZXdIZWFkZXJzKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW5zdXJpbmcgaGVhZGVyczonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0U3ByZWFkc2hlZXRDb25uZWN0aW9uKCkge1xuICB0cnkge1xuICAgIC8vIFNpIHlhIHRlbmVtb3MgdW5hIGNvbmV4acOzbiBjYWNoZWFkYSwgdmVyaWZpY2FyIHF1ZSBzaWdhIHNpZW5kbyB2w6FsaWRhXG4gICAgaWYgKGNhY2hlZERvYykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgY2FjaGVkRG9jLmxvYWRJbmZvKCk7XG4gICAgICAgIHJldHVybiBjYWNoZWREb2M7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZygnQ2FjaGVkIGNvbm5lY3Rpb24gaW52YWxpZCwgY3JlYXRpbmcgbmV3IG9uZScpO1xuICAgICAgICBjYWNoZWREb2MgPSBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IFNDT1BFUyA9IFtcbiAgICAgICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9hdXRoL3NwcmVhZHNoZWV0cycsXG4gICAgXTtcblxuICAgIGNvbnN0IGp3dCA9IG5ldyBKV1Qoe1xuICAgICAgZW1haWw6IHByb2Nlc3MuZW52LkdPT0dMRV9TSEVFVFNfQ0xJRU5UX0VNQUlMLFxuICAgICAga2V5OiBwcm9jZXNzLmVudi5HT09HTEVfU0hFRVRTX1BSSVZBVEVfS0VZPy5yZXBsYWNlKC9cXFxcbi9nLCAnXFxuJyksXG4gICAgICBzY29wZXM6IFNDT1BFUyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGRvYyA9IG5ldyBHb29nbGVTcHJlYWRzaGVldChwcm9jZXNzLmVudi5HT09HTEVfU0hFRVRTX1NQUkVBRFNIRUVUX0lEISwgand0KTtcbiAgICBhd2FpdCBkb2MubG9hZEluZm8oKTsgLy8gQXNlZ3VyYXJub3MgZGUgcXVlIGVsIGRvY3VtZW50byBlc3TDoSBjYXJnYWRvXG4gICAgXG4gICAgLy8gQXNlZ3VyYXJub3MgZGUgcXVlIGV4aXN0YW4gdG9kYXMgbGFzIGNvbHVtbmFzIG5lY2VzYXJpYXNcbiAgICBjb25zdCBzaGVldCA9IGRvYy5zaGVldHNCeUluZGV4WzBdO1xuICAgIGF3YWl0IGVuc3VyZUhlYWRlcnMoc2hlZXQpO1xuXG4gICAgLy8gU29sbyBjYWNoZWFyIGRlc3B1w6lzIGRlIHF1ZSB0b2RvIGVzdMOpIGNvcnJlY3RhbWVudGUgaW5pY2lhbGl6YWRvXG4gICAgY2FjaGVkRG9jID0gZG9jO1xuICAgIHJldHVybiBkb2M7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY2FjaGVkRG9jID0gbnVsbDtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIHNwcmVhZHNoZWV0IGNvbm5lY3Rpb246JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFNoZWV0Um93cyhzaGVldDogYW55KSB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGlmIChjYWNoZWRSb3dzICYmIChub3cgLSBsYXN0Um93c0ZldGNoKSA8IENBQ0hFX1RUTCkge1xuICAgIHJldHVybiBjYWNoZWRSb3dzO1xuICB9XG5cbiAgYXdhaXQgd2FpdEZvclJhdGVMaW1pdCgpO1xuICBjYWNoZWRSb3dzID0gYXdhaXQgc2hlZXQuZ2V0Um93cygpO1xuICBsYXN0Um93c0ZldGNoID0gbm93O1xuICByZXR1cm4gY2FjaGVkUm93cztcbn1cblxuY29uc3Qgd2FpdCA9IChtczogbnVtYmVyKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcblxuLy8gRnVuY2nDs24gcGFyYSBlamVjdXRhciB1bmEgb3BlcmFjacOzbiBjb24gdGltZW91dFxuYXN5bmMgZnVuY3Rpb24gd2l0aFRpbWVvdXQ8VD4ob3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiB7XG4gIGNvbnN0IHRpbWVvdXRQcm9taXNlID0gbmV3IFByb21pc2U8VD4oKF8sIHJlamVjdCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4gcmVqZWN0KG5ldyBFcnJvcignT3BlcmF0aW9uIHRpbWVkIG91dCcpKSwgT1BFUkFUSU9OX1RJTUVPVVQpO1xuICB9KTtcblxuICByZXR1cm4gUHJvbWlzZS5yYWNlKFtvcGVyYXRpb24oKSwgdGltZW91dFByb21pc2VdKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2l0aFJldHJ5PFQ+KG9wZXJhdGlvbjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xuICBsZXQgbGFzdEVycm9yO1xuICBcbiAgZm9yIChsZXQgYXR0ZW1wdCA9IDE7IGF0dGVtcHQgPD0gTUFYX1JFVFJJRVM7IGF0dGVtcHQrKykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgb3BlcmF0aW9uKCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgbGFzdEVycm9yID0gZXJyb3I7XG4gICAgICBjb25zb2xlLmVycm9yKGBBdHRlbXB0ICR7YXR0ZW1wdH0gZmFpbGVkOmAsIGVycm9yKTtcbiAgICAgIFxuICAgICAgaWYgKGF0dGVtcHQgPT09IE1BWF9SRVRSSUVTKSB0aHJvdyBlcnJvcjtcbiAgICAgIFxuICAgICAgLy8gU2kgZXMgdW4gZXJyb3IgZGUgcmF0ZSBsaW1pdCwgZXNwZXJhbW9zIG3DoXMgdGllbXBvXG4gICAgICBjb25zdCBkZWxheSA9IGVycm9yLnN0YXR1cyA9PT0gNDI5IFxuICAgICAgICA/IFJFVFJZX0RFTEFZICogTWF0aC5wb3coMiwgYXR0ZW1wdCArIDEpICAvLyBNw6FzIHRpZW1wbyBwYXJhIHJhdGUgbGltaXRzXG4gICAgICAgIDogUkVUUllfREVMQVkgKiBNYXRoLnBvdygyLCBhdHRlbXB0IC0gMSk7ICAvLyBUaWVtcG8gbm9ybWFsIHBhcmEgb3Ryb3MgZXJyb3Jlc1xuICAgICAgXG4gICAgICBhd2FpdCB3YWl0KGRlbGF5KTtcbiAgICB9XG4gIH1cbiAgXG4gIHRocm93IGxhc3RFcnJvcjtcbn1cblxuZXhwb3J0IGNvbnN0IEhFQURFUlMgPSBbXG4gICdkYXRlJyxcbiAgJ3dvcmtvdXRfcnVubmluZycsXG4gICd3b3Jrb3V0X3N3aW1taW5nJyxcbiAgJ3dvcmtvdXRfYWJzJyxcbiAgJ3dvcmtvdXRfY2hlc3QnLFxuICAnd29ya291dF9iYWNrJyxcbiAgJ3dvcmtvdXRfc2hvdWxkZXJzJyxcbiAgJ3dvcmtvdXRfYmljZXBzJyxcbiAgJ3dvcmtvdXRfdHJpY2VwcycsXG4gICd3b3Jrb3V0X2xlZ3MnLFxuICAnd29ya291dF9zdHJldGNoaW5nJyxcbiAgJ3dvcmtvdXRfYWVyb2JpYycsXG4gICdyZWxheF95b2dhJyxcbiAgJ3JlbGF4X21lZGl0YXRpb24nLFxuICAncmVsYXhfdGVhJyxcbiAgJ2hlYWx0aF9zbGVlcF9zZXZlbicsXG4gICdoZWFsdGhfYWNpZGl0eScsXG4gICdoZWFsdGhfc3lzdG9saWMnLFxuICAnaGVhbHRoX2RpYXN0b2xpYycsXG4gICdoZWFsdGhfaGVhZGFjaGUnLFxuICAnaGFiaXRzX25haWxfYml0aW5nJyxcbiAgJ2hhYml0c19wb3N0dXJlJyxcbiAgJ3Byb2R1Y3Rpdml0eV9sZXZlbCcsXG4gICdwcm9kdWN0aXZpdHlfcmVhZGluZ190aW1lJyxcbiAgJ251dHJpdGlvbl9mcnVpdHMnLFxuICAnbnV0cml0aW9uX3BvbHlwaGVub2xzJyxcbiAgJ251dHJpdGlvbl9oZWF2eV9mb29kJyxcbiAgJ251dHJpdGlvbl9mYXN0X2Zvb2QnLFxuICAnbnV0cml0aW9uX3lvZ3VydCcsXG4gICdsaWZlX2NvdXBsZV9kaXNjdXNzaW9ucycsXG4gICdsaWZlX2dhbWluZycsXG4gICdub3Rlcydcbl07XG5cbi8vIE1hcGEgZGUgdGlwb3MgZGUgY2FtcG9zXG5jb25zdCBGSUVMRF9UWVBFUzogUmVjb3JkPHN0cmluZywgJ2Jvb2xlYW4nIHwgJ21pbnV0ZXMnIHwgJ3NsaWRlcicgfCAndGV4dCc+ID0ge1xuICAnd29ya291dF9ydW5uaW5nJzogJ21pbnV0ZXMnLFxuICAnd29ya291dF9zd2ltbWluZyc6ICdtaW51dGVzJyxcbiAgJ3dvcmtvdXRfYWJzJzogJ2Jvb2xlYW4nLFxuICAnd29ya291dF9jaGVzdCc6ICdib29sZWFuJyxcbiAgJ3dvcmtvdXRfYmFjayc6ICdib29sZWFuJyxcbiAgJ3dvcmtvdXRfc2hvdWxkZXJzJzogJ2Jvb2xlYW4nLFxuICAnd29ya291dF9iaWNlcHMnOiAnYm9vbGVhbicsXG4gICd3b3Jrb3V0X3RyaWNlcHMnOiAnYm9vbGVhbicsXG4gICd3b3Jrb3V0X2xlZ3MnOiAnYm9vbGVhbicsXG4gICd3b3Jrb3V0X3N0cmV0Y2hpbmcnOiAnYm9vbGVhbicsXG4gICd3b3Jrb3V0X2Flcm9iaWMnOiAnYm9vbGVhbicsXG4gICdyZWxheF95b2dhJzogJ2Jvb2xlYW4nLFxuICAncmVsYXhfbWVkaXRhdGlvbic6ICdib29sZWFuJyxcbiAgJ3JlbGF4X3RlYSc6ICdib29sZWFuJyxcbiAgJ2hlYWx0aF9zbGVlcF9zZXZlbic6ICdib29sZWFuJyxcbiAgJ2hlYWx0aF9hY2lkaXR5JzogJ2Jvb2xlYW4nLFxuICAnaGVhbHRoX3N5c3RvbGljJzogJ21pbnV0ZXMnLFxuICAnaGVhbHRoX2RpYXN0b2xpYyc6ICdtaW51dGVzJyxcbiAgJ2hlYWx0aF9oZWFkYWNoZSc6ICdib29sZWFuJyxcbiAgJ2hhYml0c19uYWlsX2JpdGluZyc6ICdib29sZWFuJyxcbiAgJ2hhYml0c19wb3N0dXJlJzogJ2Jvb2xlYW4nLFxuICAncHJvZHVjdGl2aXR5X2xldmVsJzogJ3NsaWRlcicsXG4gICdwcm9kdWN0aXZpdHlfcmVhZGluZ190aW1lJzogJ21pbnV0ZXMnLFxuICAnbnV0cml0aW9uX2ZydWl0cyc6ICdtaW51dGVzJyxcbiAgJ251dHJpdGlvbl9wb2x5cGhlbm9scyc6ICdib29sZWFuJyxcbiAgJ251dHJpdGlvbl9oZWF2eV9mb29kJzogJ2Jvb2xlYW4nLFxuICAnbnV0cml0aW9uX2Zhc3RfZm9vZCc6ICdib29sZWFuJyxcbiAgJ251dHJpdGlvbl95b2d1cnQnOiAnYm9vbGVhbicsXG4gICdsaWZlX2NvdXBsZV9kaXNjdXNzaW9ucyc6ICdzbGlkZXInLFxuICAnbGlmZV9nYW1pbmcnOiAnYm9vbGVhbicsXG4gICdub3Rlcyc6ICd0ZXh0J1xufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUZpZWxkKGRhdGU6IHN0cmluZywgc2VjdGlvbklkOiBzdHJpbmcsIGZpZWxkSWQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4pIHtcbiAgcmV0dXJuIHdpdGhSZXRyeShhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZG9jID0gYXdhaXQgZ2V0U3ByZWFkc2hlZXRDb25uZWN0aW9uKCk7XG4gICAgY29uc3Qgc2hlZXQgPSBkb2Muc2hlZXRzQnlJbmRleFswXTtcbiAgICBcbiAgICAvLyBVbmEgc29sYSBsZWN0dXJhIHBhcmEgZW5jb250cmFyIG8gY3JlYXIgbGEgZmlsYVxuICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBzaGVldC5nZXRSb3dzKCk7XG4gICAgaWYgKCFyb3dzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBnZXQgc2hlZXQgcm93cycpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCByb3dJbmRleCA9IHJvd3MuZmluZEluZGV4KHJvdyA9PiByb3cuZ2V0KCdkYXRlJykgPT09IGRhdGUpO1xuICAgIGNvbnN0IGZpZWxkS2V5ID0gYCR7c2VjdGlvbklkfV8ke2ZpZWxkSWR9YDtcblxuICAgIHRyeSB7XG4gICAgICBpZiAocm93SW5kZXggPT09IC0xKSB7XG4gICAgICAgIC8vIFNpIG5vIGV4aXN0ZSBsYSBmaWxhLCBsYSBjcmVhbW9zIGNvbiBUT0RPUyBsb3MgY2FtcG9zIGluaWNpYWxpemFkb3NcbiAgICAgICAgY29uc3QgbmV3Um93OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge1xuICAgICAgICAgIGRhdGUsXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBJbmljaWFsaXphciB0b2RvcyBsb3MgY2FtcG9zIGNvbiBzdXMgdmFsb3JlcyBwb3IgZGVmZWN0byBzZWfDum4gc3UgdGlwb1xuICAgICAgICBIRUFERVJTLmZvckVhY2goaGVhZGVyID0+IHtcbiAgICAgICAgICBpZiAoaGVhZGVyID09PSAnZGF0ZScpIHJldHVybjsgLy8gU2tpcCBkYXRlIGFzIGl0J3MgYWxyZWFkeSBzZXRcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSBGSUVMRF9UWVBFU1toZWFkZXJdO1xuICAgICAgICAgIHN3aXRjaCAoZmllbGRUeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnRkFMU0UnO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21pbnV0ZXMnOlxuICAgICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcwJztcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzbGlkZXInOlxuICAgICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcxJztcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnJztcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFjdHVhbGl6YXIgZWwgY2FtcG8gZXNwZWPDrWZpY28gY29uIGVsIHZhbG9yIHByb3BvcmNpb25hZG9cbiAgICAgICAgbmV3Um93W2ZpZWxkS2V5XSA9IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nID8gdmFsdWUudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpIDogdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNvbG8gdW5hIGVzY3JpdHVyYSBwYXJhIGNyZWFyIGxhIGZpbGFcbiAgICAgICAgYXdhaXQgc2hlZXQuYWRkUm93KG5ld1Jvdyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBTaSBleGlzdGUsIGFjdHVhbGl6YW1vcyBzb2xvIGVsIGNhbXBvIGVzcGVjw61maWNvXG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgPyB2YWx1ZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkgOiB2YWx1ZS50b1N0cmluZygpO1xuICAgICAgICByb3dzW3Jvd0luZGV4XS5zZXQoZmllbGRLZXksIGZvcm1hdHRlZFZhbHVlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNvbG8gdW5hIGVzY3JpdHVyYSBwYXJhIGFjdHVhbGl6YXIgZWwgY2FtcG9cbiAgICAgICAgYXdhaXQgcm93c1tyb3dJbmRleF0uc2F2ZSgpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGVGaWVsZCBvcGVyYXRpb246Jywge1xuICAgICAgICBlcnJvcixcbiAgICAgICAgZGF0ZSxcbiAgICAgICAgc2VjdGlvbklkLFxuICAgICAgICBmaWVsZElkLFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgZmllbGRLZXlcbiAgICAgIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZU5vdGVzKGRhdGU6IHN0cmluZywgbm90ZXM6IHN0cmluZykge1xuICByZXR1cm4gd2l0aFJldHJ5KGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBkb2MgPSBhd2FpdCBnZXRTcHJlYWRzaGVldENvbm5lY3Rpb24oKTtcbiAgICBjb25zdCBzaGVldCA9IGRvYy5zaGVldHNCeUluZGV4WzBdO1xuICAgIFxuICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBzaGVldC5nZXRSb3dzKCk7XG4gICAgY29uc3Qgcm93SW5kZXggPSByb3dzLmZpbmRJbmRleChyb3cgPT4gcm93LmdldCgnZGF0ZScpID09PSBkYXRlKTtcbiAgICBcbiAgICBpZiAocm93SW5kZXggPT09IC0xKSB7XG4gICAgICAvLyBTaSBubyBleGlzdGUgbGEgZmlsYSwgbGEgY3JlYW1vcyBjb24gVE9ET1MgbG9zIGNhbXBvcyBpbmljaWFsaXphZG9zXG4gICAgICBjb25zdCBuZXdSb3c6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7XG4gICAgICAgIGRhdGUsXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBJbmljaWFsaXphciB0b2RvcyBsb3MgY2FtcG9zIGNvbiBzdXMgdmFsb3JlcyBwb3IgZGVmZWN0byBzZWfDum4gc3UgdGlwb1xuICAgICAgSEVBREVSUy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgIGlmIChoZWFkZXIgPT09ICdkYXRlJykgcmV0dXJuOyAvLyBTa2lwIGRhdGUgYXMgaXQncyBhbHJlYWR5IHNldFxuICAgICAgICBcbiAgICAgICAgY29uc3QgZmllbGRUeXBlID0gRklFTERfVFlQRVNbaGVhZGVyXTtcbiAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHtcbiAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gJ0ZBTFNFJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ21pbnV0ZXMnOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnMCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzbGlkZXInOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnMSc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gaGVhZGVyID09PSAnbm90ZXMnID8gbm90ZXMgOiAnJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2hlZXQuYWRkUm93KG5ld1Jvdyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvd3Nbcm93SW5kZXhdLnNldCgnbm90ZXMnLCBub3Rlcyk7XG4gICAgICBhd2FpdCByb3dzW3Jvd0luZGV4XS5zYXZlKCk7XG4gICAgfVxuICB9KTtcbn1cblxuaW50ZXJmYWNlIERheURhdGEge1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlQW5kTG9hZERheShkYXRlOiBzdHJpbmcpOiBQcm9taXNlPERheURhdGEgfCBudWxsPiB7XG4gIHJldHVybiB3aXRoUmV0cnkoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRvYyA9IGF3YWl0IGdldFNwcmVhZHNoZWV0Q29ubmVjdGlvbigpO1xuICAgIGNvbnN0IHNoZWV0ID0gZG9jLnNoZWV0c0J5SW5kZXhbMF07XG4gICAgXG4gICAgLy8gSW50ZW50YXIgY2FyZ2FyIGxhIGZpbGEgZXhpc3RlbnRlXG4gICAgY29uc3Qgcm93cyA9IGF3YWl0IHNoZWV0LmdldFJvd3MoKTtcbiAgICBjb25zdCBleGlzdGluZ1JvdyA9IHJvd3M/LmZpbmQocm93ID0+IHJvdy5nZXQoJ2RhdGUnKSA9PT0gZGF0ZSk7XG4gICAgXG4gICAgaWYgKGV4aXN0aW5nUm93KSB7XG4gICAgICAvLyBTaSBsYSBmaWxhIGV4aXN0ZSwgY29udmVydGlyIGxvcyB2YWxvcmVzIHNlZ8O6biBzdSB0aXBvXG4gICAgICBjb25zdCBkYXRhOiBEYXlEYXRhID0ge307XG4gICAgICBIRUFERVJTLmZvckVhY2goaGVhZGVyID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBleGlzdGluZ1Jvdy5nZXQoaGVhZGVyKTtcbiAgICAgICAgY29uc3QgZmllbGRUeXBlID0gRklFTERfVFlQRVNbaGVhZGVyXTtcbiAgICAgICAgXG4gICAgICAgIHN3aXRjaCAoZmllbGRUeXBlKSB7XG4gICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICBkYXRhW2hlYWRlcl0gPSB2YWx1ZT8udG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnbWludXRlcyc6XG4gICAgICAgICAgY2FzZSAnc2xpZGVyJzpcbiAgICAgICAgICAgIGRhdGFbaGVhZGVyXSA9IHBhcnNlSW50KHZhbHVlIHx8ICcwJywgMTApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGRhdGFbaGVhZGVyXSA9IHZhbHVlIHx8ICcnO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cbiAgICBcbiAgICAvLyBTaSBubyBleGlzdGUsIGNyZWFyIHVuYSBudWV2YSBmaWxhIGNvbiB2YWxvcmVzIHBvciBkZWZlY3RvXG4gICAgY29uc3QgbmV3Um93OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0geyBkYXRlIH07XG4gICAgSEVBREVSUy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICBpZiAoaGVhZGVyID09PSAnZGF0ZScpIHJldHVybjtcbiAgICAgIFxuICAgICAgY29uc3QgZmllbGRUeXBlID0gRklFTERfVFlQRVNbaGVhZGVyXTtcbiAgICAgIHN3aXRjaCAoZmllbGRUeXBlKSB7XG4gICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21pbnV0ZXMnOlxuICAgICAgICBjYXNlICdzbGlkZXInOlxuICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcnO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIC8vIEFncmVnYXIgbGEgbnVldmEgZmlsYVxuICAgIGF3YWl0IHNoZWV0LmFkZFJvdyhuZXdSb3cpO1xuICAgIFxuICAgIHJldHVybiBuZXdSb3c7XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlRGF5RXhpc3RzKGRhdGU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gd2l0aFJldHJ5KGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBkb2MgPSBhd2FpdCBnZXRTcHJlYWRzaGVldENvbm5lY3Rpb24oKTtcbiAgICBjb25zdCBzaGVldCA9IGRvYy5zaGVldHNCeUluZGV4WzBdO1xuICAgIFxuICAgIC8vIEludGVudGFyIGNhcmdhciBsYSBmaWxhIGV4aXN0ZW50ZVxuICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBzaGVldC5nZXRSb3dzKCk7XG4gICAgY29uc3QgZXhpc3RpbmdSb3cgPSByb3dzPy5maW5kKHJvdyA9PiByb3cuZ2V0KCdkYXRlJykgPT09IGRhdGUpO1xuICAgIFxuICAgIGlmICghZXhpc3RpbmdSb3cpIHtcbiAgICAgIC8vIFNpIG5vIGV4aXN0ZSwgY3JlYXIgdW5hIG51ZXZhIGZpbGEgY29uIHZhbG9yZXMgcG9yIGRlZmVjdG9cbiAgICAgIGNvbnN0IG5ld1JvdzogUmVjb3JkPHN0cmluZywgYW55PiA9IHsgZGF0ZSB9O1xuICAgICAgSEVBREVSUy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgIGlmIChoZWFkZXIgPT09ICdkYXRlJykgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZmllbGRUeXBlID0gRklFTERfVFlQRVNbaGVhZGVyXTtcbiAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHtcbiAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdtaW51dGVzJzpcbiAgICAgICAgICBjYXNlICdzbGlkZXInOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAwO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gJyc7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBBZ3JlZ2FyIGxhIG51ZXZhIGZpbGFcbiAgICAgIGF3YWl0IHNoZWV0LmFkZFJvdyhuZXdSb3cpO1xuICAgIH1cbiAgfSk7XG59ICJdLCJuYW1lcyI6WyJHb29nbGVTcHJlYWRzaGVldCIsIkpXVCIsIk1BWF9SRVRSSUVTIiwiUkVUUllfREVMQVkiLCJPUEVSQVRJT05fVElNRU9VVCIsIlJBVEVfTElNSVRfREVMQVkiLCJjYWNoZWREb2MiLCJsYXN0UmVxdWVzdFRpbWUiLCJjYWNoZWRSb3dzIiwibGFzdFJvd3NGZXRjaCIsIkNBQ0hFX1RUTCIsIlJPV19DQUNIRSIsIndhaXRGb3JSYXRlTGltaXQiLCJub3ciLCJEYXRlIiwidGltZVNpbmNlTGFzdFJlcXVlc3QiLCJ3YWl0IiwiZW5zdXJlSGVhZGVycyIsInNoZWV0IiwibG9hZEhlYWRlclJvdyIsImhlYWRlclZhbHVlcyIsIm1pc3NpbmdIZWFkZXJzIiwiSEVBREVSUyIsImZpbHRlciIsImhlYWRlciIsImluY2x1ZGVzIiwibGVuZ3RoIiwiY29uc29sZSIsImxvZyIsInRvdGFsQ29sdW1ucyIsImNvbHVtbkNvdW50IiwicmVzaXplIiwibmV3SGVhZGVycyIsInNldEhlYWRlclJvdyIsImVycm9yIiwiZ2V0U3ByZWFkc2hlZXRDb25uZWN0aW9uIiwibG9hZEluZm8iLCJTQ09QRVMiLCJqd3QiLCJlbWFpbCIsInByb2Nlc3MiLCJlbnYiLCJHT09HTEVfU0hFRVRTX0NMSUVOVF9FTUFJTCIsImtleSIsIkdPT0dMRV9TSEVFVFNfUFJJVkFURV9LRVkiLCJyZXBsYWNlIiwic2NvcGVzIiwiZG9jIiwiR09PR0xFX1NIRUVUU19TUFJFQURTSEVFVF9JRCIsInNoZWV0c0J5SW5kZXgiLCJnZXRTaGVldFJvd3MiLCJnZXRSb3dzIiwibXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJ3aXRoVGltZW91dCIsIm9wZXJhdGlvbiIsInRpbWVvdXRQcm9taXNlIiwiXyIsInJlamVjdCIsIkVycm9yIiwicmFjZSIsIndpdGhSZXRyeSIsImxhc3RFcnJvciIsImF0dGVtcHQiLCJkZWxheSIsInN0YXR1cyIsIk1hdGgiLCJwb3ciLCJGSUVMRF9UWVBFUyIsInVwZGF0ZUZpZWxkIiwiZGF0ZSIsInNlY3Rpb25JZCIsImZpZWxkSWQiLCJ2YWx1ZSIsInJvd3MiLCJyb3dJbmRleCIsImZpbmRJbmRleCIsInJvdyIsImdldCIsImZpZWxkS2V5IiwibmV3Um93IiwiZm9yRWFjaCIsImZpZWxkVHlwZSIsInRvU3RyaW5nIiwidG9VcHBlckNhc2UiLCJhZGRSb3ciLCJmb3JtYXR0ZWRWYWx1ZSIsInNldCIsInNhdmUiLCJ1cGRhdGVOb3RlcyIsIm5vdGVzIiwiZW5zdXJlQW5kTG9hZERheSIsImV4aXN0aW5nUm93IiwiZmluZCIsImRhdGEiLCJ0b0xvd2VyQ2FzZSIsInBhcnNlSW50IiwiZW5zdXJlRGF5RXhpc3RzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/lib/spreadsheet.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/load-historical-data/route.ts":
/*!***************************************************!*\
  !*** ./src/app/api/load-historical-data/route.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var google_spreadsheet__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! google-spreadsheet */ \"(rsc)/./node_modules/google-spreadsheet/dist/index.mjs\");\n/* harmony import */ var google_auth_library__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! google-auth-library */ \"(rsc)/./node_modules/google-auth-library/build/src/index.js\");\n/* harmony import */ var _lib_spreadsheet__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/spreadsheet */ \"(rsc)/./src/app/api/lib/spreadsheet.ts\");\n\n\n\n\nasync function GET() {\n    try {\n        const SCOPES = [\n            \"https://www.googleapis.com/auth/spreadsheets\"\n        ];\n        const jwt = new google_auth_library__WEBPACK_IMPORTED_MODULE_2__.JWT({\n            email: process.env.GOOGLE_SHEETS_CLIENT_EMAIL,\n            key: process.env.GOOGLE_SHEETS_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\"),\n            scopes: SCOPES\n        });\n        const doc = new google_spreadsheet__WEBPACK_IMPORTED_MODULE_1__.GoogleSpreadsheet(process.env.GOOGLE_SHEETS_SPREADSHEET_ID, jwt);\n        await doc.loadInfo();\n        const sheet = doc.sheetsByIndex[0];\n        const rows = await sheet.getRows();\n        // Convertir los datos a un formato más amigable para las gráficas\n        const data = rows.map((row)=>{\n            const rowData = {};\n            _lib_spreadsheet__WEBPACK_IMPORTED_MODULE_3__.HEADERS.forEach((header)=>{\n                const value = row.get(header);\n                if (header === \"date\") {\n                    rowData[header] = value;\n                } else if (value === \"TRUE\" || value === \"true\") {\n                    rowData[header] = 1; // Convertir booleanos a números para las gráficas\n                } else if (value === \"FALSE\" || value === \"false\") {\n                    rowData[header] = 0;\n                } else if (!isNaN(Number(value)) && value !== \"\") {\n                    rowData[header] = Number(value);\n                } else {\n                    rowData[header] = value || \"\";\n                }\n            });\n            return rowData;\n        });\n        // Ordenar por fecha\n        data.sort((a, b)=>new Date(a.date).getTime() - new Date(b.date).getTime());\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n    } catch (error) {\n        console.error(\"Error loading historical data:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to load historical data\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9sb2FkLWhpc3RvcmljYWwtZGF0YS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUEyQztBQUNZO0FBQ2I7QUFDRztBQUV0QyxlQUFlSTtJQUNwQixJQUFJO1FBQ0YsTUFBTUMsU0FBUztZQUNiO1NBQ0Q7UUFFRCxNQUFNQyxNQUFNLElBQUlKLG9EQUFHQSxDQUFDO1lBQ2xCSyxPQUFPQyxRQUFRQyxHQUFHLENBQUNDLDBCQUEwQjtZQUM3Q0MsS0FBS0gsUUFBUUMsR0FBRyxDQUFDRyx5QkFBeUIsRUFBRUMsUUFBUSxRQUFRO1lBQzVEQyxRQUFRVDtRQUNWO1FBRUEsTUFBTVUsTUFBTSxJQUFJZCxpRUFBaUJBLENBQUNPLFFBQVFDLEdBQUcsQ0FBQ08sNEJBQTRCLEVBQUdWO1FBQzdFLE1BQU1TLElBQUlFLFFBQVE7UUFFbEIsTUFBTUMsUUFBUUgsSUFBSUksYUFBYSxDQUFDLEVBQUU7UUFDbEMsTUFBTUMsT0FBTyxNQUFNRixNQUFNRyxPQUFPO1FBRWhDLGtFQUFrRTtRQUNsRSxNQUFNQyxPQUFPRixLQUFLRyxHQUFHLENBQUNDLENBQUFBO1lBQ3BCLE1BQU1DLFVBQStCLENBQUM7WUFFdEN0QixxREFBT0EsQ0FBQ3VCLE9BQU8sQ0FBQ0MsQ0FBQUE7Z0JBQ2QsTUFBTUMsUUFBUUosSUFBSUssR0FBRyxDQUFDRjtnQkFFdEIsSUFBSUEsV0FBVyxRQUFRO29CQUNyQkYsT0FBTyxDQUFDRSxPQUFPLEdBQUdDO2dCQUNwQixPQUFPLElBQUlBLFVBQVUsVUFBVUEsVUFBVSxRQUFRO29CQUMvQ0gsT0FBTyxDQUFDRSxPQUFPLEdBQUcsR0FBRyxrREFBa0Q7Z0JBQ3pFLE9BQU8sSUFBSUMsVUFBVSxXQUFXQSxVQUFVLFNBQVM7b0JBQ2pESCxPQUFPLENBQUNFLE9BQU8sR0FBRztnQkFDcEIsT0FBTyxJQUFJLENBQUNHLE1BQU1DLE9BQU9ILFdBQVdBLFVBQVUsSUFBSTtvQkFDaERILE9BQU8sQ0FBQ0UsT0FBTyxHQUFHSSxPQUFPSDtnQkFDM0IsT0FBTztvQkFDTEgsT0FBTyxDQUFDRSxPQUFPLEdBQUdDLFNBQVM7Z0JBQzdCO1lBQ0Y7WUFFQSxPQUFPSDtRQUNUO1FBRUEsb0JBQW9CO1FBQ3BCSCxLQUFLVSxJQUFJLENBQUMsQ0FBQ0MsR0FBR0MsSUFBTSxJQUFJQyxLQUFLRixFQUFFRyxJQUFJLEVBQUVDLE9BQU8sS0FBSyxJQUFJRixLQUFLRCxFQUFFRSxJQUFJLEVBQUVDLE9BQU87UUFFekUsT0FBT3JDLHFEQUFZQSxDQUFDc0MsSUFBSSxDQUFDaEI7SUFDM0IsRUFBRSxPQUFPaUIsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsa0NBQWtDQTtRQUNoRCxPQUFPdkMscURBQVlBLENBQUNzQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFpQyxHQUFHO1lBQUVFLFFBQVE7UUFBSTtJQUN0RjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGFpbHktcmV2aWV3Ly4vc3JjL2FwcC9hcGkvbG9hZC1oaXN0b3JpY2FsLWRhdGEvcm91dGUudHM/ZGZjNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBHb29nbGVTcHJlYWRzaGVldCB9IGZyb20gJ2dvb2dsZS1zcHJlYWRzaGVldCc7XG5pbXBvcnQgeyBKV1QgfSBmcm9tICdnb29nbGUtYXV0aC1saWJyYXJ5JztcbmltcG9ydCB7IEhFQURFUlMgfSBmcm9tICcuLi9saWIvc3ByZWFkc2hlZXQnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKCkge1xuICB0cnkge1xuICAgIGNvbnN0IFNDT1BFUyA9IFtcbiAgICAgICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9hdXRoL3NwcmVhZHNoZWV0cycsXG4gICAgXTtcblxuICAgIGNvbnN0IGp3dCA9IG5ldyBKV1Qoe1xuICAgICAgZW1haWw6IHByb2Nlc3MuZW52LkdPT0dMRV9TSEVFVFNfQ0xJRU5UX0VNQUlMLFxuICAgICAga2V5OiBwcm9jZXNzLmVudi5HT09HTEVfU0hFRVRTX1BSSVZBVEVfS0VZPy5yZXBsYWNlKC9cXFxcbi9nLCAnXFxuJyksXG4gICAgICBzY29wZXM6IFNDT1BFUyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGRvYyA9IG5ldyBHb29nbGVTcHJlYWRzaGVldChwcm9jZXNzLmVudi5HT09HTEVfU0hFRVRTX1NQUkVBRFNIRUVUX0lEISwgand0KTtcbiAgICBhd2FpdCBkb2MubG9hZEluZm8oKTtcbiAgICBcbiAgICBjb25zdCBzaGVldCA9IGRvYy5zaGVldHNCeUluZGV4WzBdO1xuICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBzaGVldC5nZXRSb3dzKCk7XG5cbiAgICAvLyBDb252ZXJ0aXIgbG9zIGRhdG9zIGEgdW4gZm9ybWF0byBtw6FzIGFtaWdhYmxlIHBhcmEgbGFzIGdyw6FmaWNhc1xuICAgIGNvbnN0IGRhdGEgPSByb3dzLm1hcChyb3cgPT4ge1xuICAgICAgY29uc3Qgcm93RGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICAgICAgXG4gICAgICBIRUFERVJTLmZvckVhY2goaGVhZGVyID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSByb3cuZ2V0KGhlYWRlcik7XG4gICAgICAgIFxuICAgICAgICBpZiAoaGVhZGVyID09PSAnZGF0ZScpIHtcbiAgICAgICAgICByb3dEYXRhW2hlYWRlcl0gPSB2YWx1ZTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ1RSVUUnIHx8IHZhbHVlID09PSAndHJ1ZScpIHtcbiAgICAgICAgICByb3dEYXRhW2hlYWRlcl0gPSAxOyAvLyBDb252ZXJ0aXIgYm9vbGVhbm9zIGEgbsO6bWVyb3MgcGFyYSBsYXMgZ3LDoWZpY2FzXG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICdGQUxTRScgfHwgdmFsdWUgPT09ICdmYWxzZScpIHtcbiAgICAgICAgICByb3dEYXRhW2hlYWRlcl0gPSAwO1xuICAgICAgICB9IGVsc2UgaWYgKCFpc05hTihOdW1iZXIodmFsdWUpKSAmJiB2YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICByb3dEYXRhW2hlYWRlcl0gPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJvd0RhdGFbaGVhZGVyXSA9IHZhbHVlIHx8ICcnO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJvd0RhdGE7XG4gICAgfSk7XG5cbiAgICAvLyBPcmRlbmFyIHBvciBmZWNoYVxuICAgIGRhdGEuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5kYXRlKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLmRhdGUpLmdldFRpbWUoKSk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oZGF0YSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBoaXN0b3JpY2FsIGRhdGE6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGxvYWQgaGlzdG9yaWNhbCBkYXRhJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJHb29nbGVTcHJlYWRzaGVldCIsIkpXVCIsIkhFQURFUlMiLCJHRVQiLCJTQ09QRVMiLCJqd3QiLCJlbWFpbCIsInByb2Nlc3MiLCJlbnYiLCJHT09HTEVfU0hFRVRTX0NMSUVOVF9FTUFJTCIsImtleSIsIkdPT0dMRV9TSEVFVFNfUFJJVkFURV9LRVkiLCJyZXBsYWNlIiwic2NvcGVzIiwiZG9jIiwiR09PR0xFX1NIRUVUU19TUFJFQURTSEVFVF9JRCIsImxvYWRJbmZvIiwic2hlZXQiLCJzaGVldHNCeUluZGV4Iiwicm93cyIsImdldFJvd3MiLCJkYXRhIiwibWFwIiwicm93Iiwicm93RGF0YSIsImZvckVhY2giLCJoZWFkZXIiLCJ2YWx1ZSIsImdldCIsImlzTmFOIiwiTnVtYmVyIiwic29ydCIsImEiLCJiIiwiRGF0ZSIsImRhdGUiLCJnZXRUaW1lIiwianNvbiIsImVycm9yIiwiY29uc29sZSIsInN0YXR1cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/load-historical-data/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/lodash","vendor-chunks/google-auth-library","vendor-chunks/tr46","vendor-chunks/mime-db","vendor-chunks/axios","vendor-chunks/bignumber.js","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/gaxios","vendor-chunks/google-spreadsheet","vendor-chunks/json-bigint","vendor-chunks/follow-redirects","vendor-chunks/google-logging-utils","vendor-chunks/gcp-metadata","vendor-chunks/debug","vendor-chunks/form-data","vendor-chunks/https-proxy-agent","vendor-chunks/gtoken","vendor-chunks/uuid","vendor-chunks/agent-base","vendor-chunks/asynckit","vendor-chunks/jws","vendor-chunks/jwa","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/webidl-conversions","vendor-chunks/combined-stream","vendor-chunks/base64-js","vendor-chunks/mime-types","vendor-chunks/proxy-from-env","vendor-chunks/extend","vendor-chunks/ms","vendor-chunks/supports-color","vendor-chunks/delayed-stream","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time","vendor-chunks/is-stream","vendor-chunks/has-flag"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-historical-data%2Froute&page=%2Fapi%2Fload-historical-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-historical-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();