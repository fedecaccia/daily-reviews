"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/load-data/route";
exports.ids = ["app/api/load-data/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:events":
/*!******************************!*\
  !*** external "node:events" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:events");

/***/ }),

/***/ "node:process":
/*!*******************************!*\
  !*** external "node:process" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("node:process");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-data%2Froute&page=%2Fapi%2Fload-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-data%2Froute&page=%2Fapi%2Fload-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_federicocaccia_code_daily_review_src_app_api_load_data_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/load-data/route.ts */ \"(rsc)/./src/app/api/load-data/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/load-data/route\",\n        pathname: \"/api/load-data\",\n        filename: \"route\",\n        bundlePath: \"app/api/load-data/route\"\n    },\n    resolvedPagePath: \"/Users/federicocaccia/code/daily-review/src/app/api/load-data/route.ts\",\n    nextConfigOutput,\n    userland: _Users_federicocaccia_code_daily_review_src_app_api_load_data_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/load-data/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZsb2FkLWRhdGElMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmxvYWQtZGF0YSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmxvYWQtZGF0YSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmZlZGVyaWNvY2FjY2lhJTJGY29kZSUyRmRhaWx5LXJldmlldyUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZmZWRlcmljb2NhY2NpYSUyRmNvZGUlMkZkYWlseS1yZXZpZXcmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3NCO0FBQ25HO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGFpbHktcmV2aWV3Lz83ODg2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9mZWRlcmljb2NhY2NpYS9jb2RlL2RhaWx5LXJldmlldy9zcmMvYXBwL2FwaS9sb2FkLWRhdGEvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2xvYWQtZGF0YS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2xvYWQtZGF0YVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbG9hZC1kYXRhL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2ZlZGVyaWNvY2FjY2lhL2NvZGUvZGFpbHktcmV2aWV3L3NyYy9hcHAvYXBpL2xvYWQtZGF0YS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvbG9hZC1kYXRhL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-data%2Froute&page=%2Fapi%2Fload-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/lib/spreadsheet.ts":
/*!****************************************!*\
  !*** ./src/app/api/lib/spreadsheet.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   HEADERS: () => (/* binding */ HEADERS),\n/* harmony export */   ensureAndLoadDay: () => (/* binding */ ensureAndLoadDay),\n/* harmony export */   ensureDayExists: () => (/* binding */ ensureDayExists),\n/* harmony export */   updateField: () => (/* binding */ updateField),\n/* harmony export */   updateNotes: () => (/* binding */ updateNotes)\n/* harmony export */ });\n/* harmony import */ var google_spreadsheet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! google-spreadsheet */ \"(rsc)/./node_modules/google-spreadsheet/dist/index.mjs\");\n/* harmony import */ var google_auth_library__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! google-auth-library */ \"(rsc)/./node_modules/google-auth-library/build/src/index.js\");\n\n\n// Constantes\nconst MAX_RETRIES = 3;\nconst RETRY_DELAY = 1000; // ms\nconst OPERATION_TIMEOUT = 1000; // 5 segundos máximo por operación\nconst RATE_LIMIT_DELAY = 1000; // Aumentado a 5 segundos entre operaciones\n// Cache de conexión y datos\nlet cachedDoc = null;\nlet lastRequestTime = 0;\nlet cachedRows = null;\nlet lastRowsFetch = 0;\nconst CACHE_TTL = 5000; // Aumentado a 5 segundos de TTL para el cache\nconst ROW_CACHE = {}; // Cache para filas individuales\nasync function waitForRateLimit() {\n    const now = Date.now();\n    const timeSinceLastRequest = now - lastRequestTime;\n    if (timeSinceLastRequest < RATE_LIMIT_DELAY) {\n        await wait(RATE_LIMIT_DELAY - timeSinceLastRequest);\n    }\n    lastRequestTime = Date.now();\n}\nasync function ensureHeaders(sheet) {\n    try {\n        // Primero cargar la hoja\n        await sheet.loadHeaderRow();\n        const headerValues = sheet.headerValues;\n        // Verificar qué headers faltan\n        const missingHeaders = HEADERS.filter((header)=>!headerValues.includes(header));\n        if (missingHeaders.length > 0) {\n            console.log(\"Adding new headers at the end:\", missingHeaders);\n            // Calcular el número total de columnas necesarias\n            const totalColumns = headerValues.length + missingHeaders.length;\n            // Redimensionar la hoja si es necesario\n            if (sheet.columnCount < totalColumns) {\n                console.log(`Resizing sheet from ${sheet.columnCount} to ${totalColumns} columns`);\n                await sheet.resize({\n                    columnCount: totalColumns\n                });\n            }\n            // Agregar los headers faltantes al final\n            const newHeaders = [\n                ...headerValues,\n                ...missingHeaders\n            ];\n            await sheet.setHeaderRow(newHeaders);\n        }\n    } catch (error) {\n        console.error(\"Error ensuring headers:\", error);\n        throw error;\n    }\n}\nasync function getSpreadsheetConnection() {\n    try {\n        // Si ya tenemos una conexión cacheada, verificar que siga siendo válida\n        if (cachedDoc) {\n            try {\n                await cachedDoc.loadInfo();\n                return cachedDoc;\n            } catch (error) {\n                console.log(\"Cached connection invalid, creating new one\");\n                cachedDoc = null;\n            }\n        }\n        const SCOPES = [\n            \"https://www.googleapis.com/auth/spreadsheets\"\n        ];\n        const jwt = new google_auth_library__WEBPACK_IMPORTED_MODULE_1__.JWT({\n            email: process.env.GOOGLE_SHEETS_CLIENT_EMAIL,\n            key: process.env.GOOGLE_SHEETS_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\"),\n            scopes: SCOPES\n        });\n        const doc = new google_spreadsheet__WEBPACK_IMPORTED_MODULE_0__.GoogleSpreadsheet(process.env.GOOGLE_SHEETS_SPREADSHEET_ID, jwt);\n        await doc.loadInfo(); // Asegurarnos de que el documento está cargado\n        // Asegurarnos de que existan todas las columnas necesarias\n        const sheet = doc.sheetsByIndex[0];\n        await ensureHeaders(sheet);\n        // Solo cachear después de que todo esté correctamente inicializado\n        cachedDoc = doc;\n        return doc;\n    } catch (error) {\n        cachedDoc = null;\n        console.error(\"Error getting spreadsheet connection:\", error);\n        throw error;\n    }\n}\nasync function getSheetRows(sheet) {\n    const now = Date.now();\n    if (cachedRows && now - lastRowsFetch < CACHE_TTL) {\n        return cachedRows;\n    }\n    await waitForRateLimit();\n    cachedRows = await sheet.getRows();\n    lastRowsFetch = now;\n    return cachedRows;\n}\nconst wait = (ms)=>new Promise((resolve)=>setTimeout(resolve, ms));\n// Función para ejecutar una operación con timeout\nasync function withTimeout(operation) {\n    const timeoutPromise = new Promise((_, reject)=>{\n        setTimeout(()=>reject(new Error(\"Operation timed out\")), OPERATION_TIMEOUT);\n    });\n    return Promise.race([\n        operation(),\n        timeoutPromise\n    ]);\n}\nasync function withRetry(operation) {\n    let lastError;\n    for(let attempt = 1; attempt <= MAX_RETRIES; attempt++){\n        try {\n            return await operation();\n        } catch (error) {\n            lastError = error;\n            console.error(`Attempt ${attempt} failed:`, error);\n            if (attempt === MAX_RETRIES) throw error;\n            // Si es un error de rate limit, esperamos más tiempo\n            const delay = error.status === 429 ? RETRY_DELAY * Math.pow(2, attempt + 1) // Más tiempo para rate limits\n             : RETRY_DELAY * Math.pow(2, attempt - 1); // Tiempo normal para otros errores\n            await wait(delay);\n        }\n    }\n    throw lastError;\n}\nconst HEADERS = [\n    \"date\",\n    \"workout_running\",\n    \"workout_abs\",\n    \"workout_chest\",\n    \"workout_back\",\n    \"workout_shoulders\",\n    \"workout_biceps\",\n    \"workout_triceps\",\n    \"workout_legs\",\n    \"workout_stretching\",\n    \"workout_aerobic\",\n    \"relax_yoga\",\n    \"relax_meditation\",\n    \"relax_tea\",\n    \"health_sleep_seven\",\n    \"health_acidity\",\n    \"health_systolic\",\n    \"health_diastolic\",\n    \"health_headache\",\n    \"habits_nail_biting\",\n    \"habits_posture\",\n    \"productivity_level\",\n    \"productivity_reading_time\",\n    \"nutrition_fruits\",\n    \"nutrition_polyphenols\",\n    \"nutrition_heavy_food\",\n    \"nutrition_fast_food\",\n    \"nutrition_yogurt\",\n    \"life_couple_discussions\",\n    \"life_gaming\",\n    \"notes\"\n];\n// Mapa de tipos de campos\nconst FIELD_TYPES = {\n    \"workout_running\": \"minutes\",\n    \"workout_abs\": \"boolean\",\n    \"workout_chest\": \"boolean\",\n    \"workout_back\": \"boolean\",\n    \"workout_shoulders\": \"boolean\",\n    \"workout_biceps\": \"boolean\",\n    \"workout_triceps\": \"boolean\",\n    \"workout_legs\": \"boolean\",\n    \"workout_stretching\": \"boolean\",\n    \"workout_aerobic\": \"boolean\",\n    \"relax_yoga\": \"boolean\",\n    \"relax_meditation\": \"boolean\",\n    \"relax_tea\": \"boolean\",\n    \"health_sleep_seven\": \"boolean\",\n    \"health_acidity\": \"boolean\",\n    \"health_systolic\": \"minutes\",\n    \"health_diastolic\": \"minutes\",\n    \"health_headache\": \"boolean\",\n    \"habits_nail_biting\": \"boolean\",\n    \"habits_posture\": \"boolean\",\n    \"productivity_level\": \"slider\",\n    \"productivity_reading_time\": \"minutes\",\n    \"nutrition_fruits\": \"minutes\",\n    \"nutrition_polyphenols\": \"boolean\",\n    \"nutrition_heavy_food\": \"boolean\",\n    \"nutrition_fast_food\": \"boolean\",\n    \"nutrition_yogurt\": \"boolean\",\n    \"life_couple_discussions\": \"slider\",\n    \"life_gaming\": \"boolean\",\n    \"notes\": \"text\"\n};\nasync function updateField(date, sectionId, fieldId, value) {\n    return withRetry(async ()=>{\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        // Una sola lectura para encontrar o crear la fila\n        const rows = await sheet.getRows();\n        const rowIndex = rows.findIndex((row)=>row.get(\"date\") === date);\n        const fieldKey = `${sectionId}_${fieldId}`;\n        try {\n            if (rowIndex === -1) {\n                // Si no existe la fila, la creamos con TODOS los campos inicializados\n                const newRow = {\n                    date\n                };\n                // Inicializar todos los campos con sus valores por defecto según su tipo\n                HEADERS.forEach((header)=>{\n                    if (header === \"date\") return; // Skip date as it's already set\n                    const fieldType = FIELD_TYPES[header];\n                    switch(fieldType){\n                        case \"boolean\":\n                            newRow[header] = \"FALSE\";\n                            break;\n                        case \"minutes\":\n                            newRow[header] = \"0\";\n                            break;\n                        case \"slider\":\n                            newRow[header] = \"1\";\n                            break;\n                        case \"text\":\n                            newRow[header] = \"\";\n                            break;\n                    }\n                });\n                // Actualizar el campo específico con el valor proporcionado\n                newRow[fieldKey] = typeof value === \"boolean\" ? value.toString().toUpperCase() : value.toString();\n                // Solo una escritura para crear la fila\n                await sheet.addRow(newRow);\n            } else {\n                // Si existe, actualizamos solo el campo específico\n                const formattedValue = typeof value === \"boolean\" ? value.toString().toUpperCase() : value.toString();\n                rows[rowIndex].set(fieldKey, formattedValue);\n                // Solo una escritura para actualizar el campo\n                await rows[rowIndex].save();\n            }\n        } catch (error) {\n            console.error(\"Error in updateField operation:\", {\n                error,\n                date,\n                sectionId,\n                fieldId,\n                value,\n                fieldKey\n            });\n            throw error;\n        }\n    });\n}\nasync function updateNotes(date, notes) {\n    return withRetry(async ()=>{\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        const rows = await sheet.getRows();\n        const rowIndex = rows.findIndex((row)=>row.get(\"date\") === date);\n        if (rowIndex === -1) {\n            // Si no existe la fila, la creamos con TODOS los campos inicializados\n            const newRow = {\n                date\n            };\n            // Inicializar todos los campos con sus valores por defecto según su tipo\n            HEADERS.forEach((header)=>{\n                if (header === \"date\") return; // Skip date as it's already set\n                const fieldType = FIELD_TYPES[header];\n                switch(fieldType){\n                    case \"boolean\":\n                        newRow[header] = \"FALSE\";\n                        break;\n                    case \"minutes\":\n                        newRow[header] = \"0\";\n                        break;\n                    case \"slider\":\n                        newRow[header] = \"1\";\n                        break;\n                    case \"text\":\n                        newRow[header] = header === \"notes\" ? notes : \"\";\n                        break;\n                }\n            });\n            await sheet.addRow(newRow);\n        } else {\n            rows[rowIndex].set(\"notes\", notes);\n            await rows[rowIndex].save();\n        }\n    });\n}\nasync function ensureAndLoadDay(date) {\n    return withRetry(async ()=>{\n        // Verificar cache\n        if (ROW_CACHE[date] && Date.now() - ROW_CACHE[date].timestamp < CACHE_TTL) {\n            return ROW_CACHE[date].data;\n        }\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        // Una sola lectura para obtener/crear los datos del día\n        const rows = await getSheetRows(sheet);\n        let row = rows.find((row)=>row.get(\"date\") === date);\n        if (!row) {\n            // Crear la fila con valores por defecto\n            const newRow = {\n                date\n            };\n            // Inicializar todos los campos con sus valores por defecto\n            HEADERS.forEach((header)=>{\n                if (header === \"date\") return;\n                const fieldType = FIELD_TYPES[header];\n                switch(fieldType){\n                    case \"boolean\":\n                        newRow[header] = \"FALSE\";\n                        break;\n                    case \"minutes\":\n                        newRow[header] = \"0\";\n                        break;\n                    case \"slider\":\n                        newRow[header] = \"1\";\n                        break;\n                    case \"text\":\n                        newRow[header] = \"\";\n                        break;\n                }\n            });\n            row = await sheet.addRow(newRow);\n        }\n        const data = {};\n        HEADERS.forEach((header)=>{\n            const value = row.get(header);\n            if (header === \"notes\") {\n                data[header] = value || \"\";\n            } else if (header === \"date\") {\n                data[header] = value;\n            } else {\n                if (value === \"TRUE\" || value === \"true\") {\n                    data[header] = true;\n                } else if (value === \"FALSE\" || value === \"false\") {\n                    data[header] = false;\n                } else if (!isNaN(Number(value)) && value !== \"\") {\n                    data[header] = Number(value);\n                } else {\n                    data[header] = value || \"\";\n                }\n            }\n        });\n        // Guardar en cache\n        ROW_CACHE[date] = {\n            data,\n            timestamp: Date.now()\n        };\n        return data;\n    });\n}\nasync function ensureDayExists(date) {\n    return withRetry(async ()=>{\n        const doc = await getSpreadsheetConnection();\n        const sheet = doc.sheetsByIndex[0];\n        // Verificar si ya existe la fila\n        const rows = await sheet.getRows();\n        const rowExists = rows.some((row)=>row.get(\"date\") === date);\n        if (!rowExists) {\n            // Crear la fila con valores por defecto\n            const newRow = {\n                date\n            };\n            // Inicializar todos los campos con sus valores por defecto\n            HEADERS.forEach((header)=>{\n                if (header === \"date\") return;\n                const fieldType = FIELD_TYPES[header];\n                switch(fieldType){\n                    case \"boolean\":\n                        newRow[header] = \"FALSE\";\n                        break;\n                    case \"minutes\":\n                        newRow[header] = \"0\";\n                        break;\n                    case \"slider\":\n                        newRow[header] = \"1\";\n                        break;\n                    case \"text\":\n                        newRow[header] = \"\";\n                        break;\n                }\n            });\n            await sheet.addRow(newRow);\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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d0JBQ0gwRCxNQUFNLENBQUMxRCxPQUFPLEdBQUc7d0JBQ2pCO29CQUNGLEtBQUs7d0JBQ0gwRCxNQUFNLENBQUMxRCxPQUFPLEdBQUc7d0JBQ2pCO2dCQUNKO1lBQ0Y7WUFFQSxNQUFNTixNQUFNcUUsTUFBTSxDQUFDTDtRQUNyQjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYWlseS1yZXZpZXcvLi9zcmMvYXBwL2FwaS9saWIvc3ByZWFkc2hlZXQudHM/NDNkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHb29nbGVTcHJlYWRzaGVldCB9IGZyb20gJ2dvb2dsZS1zcHJlYWRzaGVldCc7XG5pbXBvcnQgeyBKV1QgfSBmcm9tICdnb29nbGUtYXV0aC1saWJyYXJ5JztcblxuLy8gQ29uc3RhbnRlc1xuY29uc3QgTUFYX1JFVFJJRVMgPSAzO1xuY29uc3QgUkVUUllfREVMQVkgPSAxMDAwOyAvLyBtc1xuY29uc3QgT1BFUkFUSU9OX1RJTUVPVVQgPSAxMDAwOyAvLyA1IHNlZ3VuZG9zIG3DoXhpbW8gcG9yIG9wZXJhY2nDs25cbmNvbnN0IFJBVEVfTElNSVRfREVMQVkgPSAxMDAwOyAvLyBBdW1lbnRhZG8gYSA1IHNlZ3VuZG9zIGVudHJlIG9wZXJhY2lvbmVzXG5cbi8vIENhY2hlIGRlIGNvbmV4acOzbiB5IGRhdG9zXG5sZXQgY2FjaGVkRG9jOiBHb29nbGVTcHJlYWRzaGVldCB8IG51bGwgPSBudWxsO1xubGV0IGxhc3RSZXF1ZXN0VGltZSA9IDA7XG5sZXQgY2FjaGVkUm93czogYW55W10gfCBudWxsID0gbnVsbDtcbmxldCBsYXN0Um93c0ZldGNoID0gMDtcbmNvbnN0IENBQ0hFX1RUTCA9IDUwMDA7IC8vIEF1bWVudGFkbyBhIDUgc2VndW5kb3MgZGUgVFRMIHBhcmEgZWwgY2FjaGVcbmNvbnN0IFJPV19DQUNIRTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9OyAvLyBDYWNoZSBwYXJhIGZpbGFzIGluZGl2aWR1YWxlc1xuXG5hc3luYyBmdW5jdGlvbiB3YWl0Rm9yUmF0ZUxpbWl0KCkge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCB0aW1lU2luY2VMYXN0UmVxdWVzdCA9IG5vdyAtIGxhc3RSZXF1ZXN0VGltZTtcbiAgXG4gIGlmICh0aW1lU2luY2VMYXN0UmVxdWVzdCA8IFJBVEVfTElNSVRfREVMQVkpIHtcbiAgICBhd2FpdCB3YWl0KFJBVEVfTElNSVRfREVMQVkgLSB0aW1lU2luY2VMYXN0UmVxdWVzdCk7XG4gIH1cbiAgXG4gIGxhc3RSZXF1ZXN0VGltZSA9IERhdGUubm93KCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGVuc3VyZUhlYWRlcnMoc2hlZXQ6IGFueSkge1xuICB0cnkge1xuICAgIC8vIFByaW1lcm8gY2FyZ2FyIGxhIGhvamFcbiAgICBhd2FpdCBzaGVldC5sb2FkSGVhZGVyUm93KCk7XG4gICAgY29uc3QgaGVhZGVyVmFsdWVzID0gc2hlZXQuaGVhZGVyVmFsdWVzO1xuICAgIFxuICAgIC8vIFZlcmlmaWNhciBxdcOpIGhlYWRlcnMgZmFsdGFuXG4gICAgY29uc3QgbWlzc2luZ0hlYWRlcnMgPSBIRUFERVJTLmZpbHRlcihoZWFkZXIgPT4gIWhlYWRlclZhbHVlcy5pbmNsdWRlcyhoZWFkZXIpKTtcbiAgICBcbiAgICBpZiAobWlzc2luZ0hlYWRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coJ0FkZGluZyBuZXcgaGVhZGVycyBhdCB0aGUgZW5kOicsIG1pc3NpbmdIZWFkZXJzKTtcbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXIgZWwgbsO6bWVybyB0b3RhbCBkZSBjb2x1bW5hcyBuZWNlc2FyaWFzXG4gICAgICBjb25zdCB0b3RhbENvbHVtbnMgPSBoZWFkZXJWYWx1ZXMubGVuZ3RoICsgbWlzc2luZ0hlYWRlcnMubGVuZ3RoO1xuICAgICAgXG4gICAgICAvLyBSZWRpbWVuc2lvbmFyIGxhIGhvamEgc2kgZXMgbmVjZXNhcmlvXG4gICAgICBpZiAoc2hlZXQuY29sdW1uQ291bnQgPCB0b3RhbENvbHVtbnMpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFJlc2l6aW5nIHNoZWV0IGZyb20gJHtzaGVldC5jb2x1bW5Db3VudH0gdG8gJHt0b3RhbENvbHVtbnN9IGNvbHVtbnNgKTtcbiAgICAgICAgYXdhaXQgc2hlZXQucmVzaXplKHsgY29sdW1uQ291bnQ6IHRvdGFsQ29sdW1ucyB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWdyZWdhciBsb3MgaGVhZGVycyBmYWx0YW50ZXMgYWwgZmluYWxcbiAgICAgIGNvbnN0IG5ld0hlYWRlcnMgPSBbLi4uaGVhZGVyVmFsdWVzLCAuLi5taXNzaW5nSGVhZGVyc107XG4gICAgICBhd2FpdCBzaGVldC5zZXRIZWFkZXJSb3cobmV3SGVhZGVycyk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuc3VyaW5nIGhlYWRlcnM6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFNwcmVhZHNoZWV0Q29ubmVjdGlvbigpIHtcbiAgdHJ5IHtcbiAgICAvLyBTaSB5YSB0ZW5lbW9zIHVuYSBjb25leGnDs24gY2FjaGVhZGEsIHZlcmlmaWNhciBxdWUgc2lnYSBzaWVuZG8gdsOhbGlkYVxuICAgIGlmIChjYWNoZWREb2MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGNhY2hlZERvYy5sb2FkSW5mbygpO1xuICAgICAgICByZXR1cm4gY2FjaGVkRG9jO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0NhY2hlZCBjb25uZWN0aW9uIGludmFsaWQsIGNyZWF0aW5nIG5ldyBvbmUnKTtcbiAgICAgICAgY2FjaGVkRG9jID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBTQ09QRVMgPSBbXG4gICAgICAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9zcHJlYWRzaGVldHMnLFxuICAgIF07XG5cbiAgICBjb25zdCBqd3QgPSBuZXcgSldUKHtcbiAgICAgIGVtYWlsOiBwcm9jZXNzLmVudi5HT09HTEVfU0hFRVRTX0NMSUVOVF9FTUFJTCxcbiAgICAgIGtleTogcHJvY2Vzcy5lbnYuR09PR0xFX1NIRUVUU19QUklWQVRFX0tFWT8ucmVwbGFjZSgvXFxcXG4vZywgJ1xcbicpLFxuICAgICAgc2NvcGVzOiBTQ09QRVMsXG4gICAgfSk7XG5cbiAgICBjb25zdCBkb2MgPSBuZXcgR29vZ2xlU3ByZWFkc2hlZXQocHJvY2Vzcy5lbnYuR09PR0xFX1NIRUVUU19TUFJFQURTSEVFVF9JRCEsIGp3dCk7XG4gICAgYXdhaXQgZG9jLmxvYWRJbmZvKCk7IC8vIEFzZWd1cmFybm9zIGRlIHF1ZSBlbCBkb2N1bWVudG8gZXN0w6EgY2FyZ2Fkb1xuICAgIFxuICAgIC8vIEFzZWd1cmFybm9zIGRlIHF1ZSBleGlzdGFuIHRvZGFzIGxhcyBjb2x1bW5hcyBuZWNlc2FyaWFzXG4gICAgY29uc3Qgc2hlZXQgPSBkb2Muc2hlZXRzQnlJbmRleFswXTtcbiAgICBhd2FpdCBlbnN1cmVIZWFkZXJzKHNoZWV0KTtcblxuICAgIC8vIFNvbG8gY2FjaGVhciBkZXNwdcOpcyBkZSBxdWUgdG9kbyBlc3TDqSBjb3JyZWN0YW1lbnRlIGluaWNpYWxpemFkb1xuICAgIGNhY2hlZERvYyA9IGRvYztcbiAgICByZXR1cm4gZG9jO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNhY2hlZERvYyA9IG51bGw7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBzcHJlYWRzaGVldCBjb25uZWN0aW9uOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRTaGVldFJvd3Moc2hlZXQ6IGFueSkge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBpZiAoY2FjaGVkUm93cyAmJiAobm93IC0gbGFzdFJvd3NGZXRjaCkgPCBDQUNIRV9UVEwpIHtcbiAgICByZXR1cm4gY2FjaGVkUm93cztcbiAgfVxuXG4gIGF3YWl0IHdhaXRGb3JSYXRlTGltaXQoKTtcbiAgY2FjaGVkUm93cyA9IGF3YWl0IHNoZWV0LmdldFJvd3MoKTtcbiAgbGFzdFJvd3NGZXRjaCA9IG5vdztcbiAgcmV0dXJuIGNhY2hlZFJvd3M7XG59XG5cbmNvbnN0IHdhaXQgPSAobXM6IG51bWJlcikgPT4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG5cbi8vIEZ1bmNpw7NuIHBhcmEgZWplY3V0YXIgdW5hIG9wZXJhY2nDs24gY29uIHRpbWVvdXRcbmFzeW5jIGZ1bmN0aW9uIHdpdGhUaW1lb3V0PFQ+KG9wZXJhdGlvbjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xuICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlPFQ+KChfLCByZWplY3QpID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ09wZXJhdGlvbiB0aW1lZCBvdXQnKSksIE9QRVJBVElPTl9USU1FT1VUKTtcbiAgfSk7XG5cbiAgcmV0dXJuIFByb21pc2UucmFjZShbb3BlcmF0aW9uKCksIHRpbWVvdXRQcm9taXNlXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHdpdGhSZXRyeTxUPihvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcbiAgbGV0IGxhc3RFcnJvcjtcbiAgXG4gIGZvciAobGV0IGF0dGVtcHQgPSAxOyBhdHRlbXB0IDw9IE1BWF9SRVRSSUVTOyBhdHRlbXB0KyspIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IG9wZXJhdGlvbigpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGxhc3RFcnJvciA9IGVycm9yO1xuICAgICAgY29uc29sZS5lcnJvcihgQXR0ZW1wdCAke2F0dGVtcHR9IGZhaWxlZDpgLCBlcnJvcik7XG4gICAgICBcbiAgICAgIGlmIChhdHRlbXB0ID09PSBNQVhfUkVUUklFUykgdGhyb3cgZXJyb3I7XG4gICAgICBcbiAgICAgIC8vIFNpIGVzIHVuIGVycm9yIGRlIHJhdGUgbGltaXQsIGVzcGVyYW1vcyBtw6FzIHRpZW1wb1xuICAgICAgY29uc3QgZGVsYXkgPSBlcnJvci5zdGF0dXMgPT09IDQyOSBcbiAgICAgICAgPyBSRVRSWV9ERUxBWSAqIE1hdGgucG93KDIsIGF0dGVtcHQgKyAxKSAgLy8gTcOhcyB0aWVtcG8gcGFyYSByYXRlIGxpbWl0c1xuICAgICAgICA6IFJFVFJZX0RFTEFZICogTWF0aC5wb3coMiwgYXR0ZW1wdCAtIDEpOyAgLy8gVGllbXBvIG5vcm1hbCBwYXJhIG90cm9zIGVycm9yZXNcbiAgICAgIFxuICAgICAgYXdhaXQgd2FpdChkZWxheSk7XG4gICAgfVxuICB9XG4gIFxuICB0aHJvdyBsYXN0RXJyb3I7XG59XG5cbmV4cG9ydCBjb25zdCBIRUFERVJTID0gW1xuICAnZGF0ZScsXG4gICd3b3Jrb3V0X3J1bm5pbmcnLFxuICAnd29ya291dF9hYnMnLFxuICAnd29ya291dF9jaGVzdCcsXG4gICd3b3Jrb3V0X2JhY2snLFxuICAnd29ya291dF9zaG91bGRlcnMnLFxuICAnd29ya291dF9iaWNlcHMnLFxuICAnd29ya291dF90cmljZXBzJyxcbiAgJ3dvcmtvdXRfbGVncycsXG4gICd3b3Jrb3V0X3N0cmV0Y2hpbmcnLFxuICAnd29ya291dF9hZXJvYmljJyxcbiAgJ3JlbGF4X3lvZ2EnLFxuICAncmVsYXhfbWVkaXRhdGlvbicsXG4gICdyZWxheF90ZWEnLFxuICAnaGVhbHRoX3NsZWVwX3NldmVuJyxcbiAgJ2hlYWx0aF9hY2lkaXR5JyxcbiAgJ2hlYWx0aF9zeXN0b2xpYycsXG4gICdoZWFsdGhfZGlhc3RvbGljJyxcbiAgJ2hlYWx0aF9oZWFkYWNoZScsXG4gICdoYWJpdHNfbmFpbF9iaXRpbmcnLFxuICAnaGFiaXRzX3Bvc3R1cmUnLFxuICAncHJvZHVjdGl2aXR5X2xldmVsJyxcbiAgJ3Byb2R1Y3Rpdml0eV9yZWFkaW5nX3RpbWUnLFxuICAnbnV0cml0aW9uX2ZydWl0cycsXG4gICdudXRyaXRpb25fcG9seXBoZW5vbHMnLFxuICAnbnV0cml0aW9uX2hlYXZ5X2Zvb2QnLFxuICAnbnV0cml0aW9uX2Zhc3RfZm9vZCcsXG4gICdudXRyaXRpb25feW9ndXJ0JyxcbiAgJ2xpZmVfY291cGxlX2Rpc2N1c3Npb25zJyxcbiAgJ2xpZmVfZ2FtaW5nJyxcbiAgJ25vdGVzJ1xuXTtcblxuLy8gTWFwYSBkZSB0aXBvcyBkZSBjYW1wb3NcbmNvbnN0IEZJRUxEX1RZUEVTOiBSZWNvcmQ8c3RyaW5nLCAnYm9vbGVhbicgfCAnbWludXRlcycgfCAnc2xpZGVyJyB8ICd0ZXh0Jz4gPSB7XG4gICd3b3Jrb3V0X3J1bm5pbmcnOiAnbWludXRlcycsXG4gICd3b3Jrb3V0X2Ficyc6ICdib29sZWFuJyxcbiAgJ3dvcmtvdXRfY2hlc3QnOiAnYm9vbGVhbicsXG4gICd3b3Jrb3V0X2JhY2snOiAnYm9vbGVhbicsXG4gICd3b3Jrb3V0X3Nob3VsZGVycyc6ICdib29sZWFuJyxcbiAgJ3dvcmtvdXRfYmljZXBzJzogJ2Jvb2xlYW4nLFxuICAnd29ya291dF90cmljZXBzJzogJ2Jvb2xlYW4nLFxuICAnd29ya291dF9sZWdzJzogJ2Jvb2xlYW4nLFxuICAnd29ya291dF9zdHJldGNoaW5nJzogJ2Jvb2xlYW4nLFxuICAnd29ya291dF9hZXJvYmljJzogJ2Jvb2xlYW4nLFxuICAncmVsYXhfeW9nYSc6ICdib29sZWFuJyxcbiAgJ3JlbGF4X21lZGl0YXRpb24nOiAnYm9vbGVhbicsXG4gICdyZWxheF90ZWEnOiAnYm9vbGVhbicsXG4gICdoZWFsdGhfc2xlZXBfc2V2ZW4nOiAnYm9vbGVhbicsXG4gICdoZWFsdGhfYWNpZGl0eSc6ICdib29sZWFuJyxcbiAgJ2hlYWx0aF9zeXN0b2xpYyc6ICdtaW51dGVzJyxcbiAgJ2hlYWx0aF9kaWFzdG9saWMnOiAnbWludXRlcycsXG4gICdoZWFsdGhfaGVhZGFjaGUnOiAnYm9vbGVhbicsXG4gICdoYWJpdHNfbmFpbF9iaXRpbmcnOiAnYm9vbGVhbicsXG4gICdoYWJpdHNfcG9zdHVyZSc6ICdib29sZWFuJyxcbiAgJ3Byb2R1Y3Rpdml0eV9sZXZlbCc6ICdzbGlkZXInLFxuICAncHJvZHVjdGl2aXR5X3JlYWRpbmdfdGltZSc6ICdtaW51dGVzJyxcbiAgJ251dHJpdGlvbl9mcnVpdHMnOiAnbWludXRlcycsXG4gICdudXRyaXRpb25fcG9seXBoZW5vbHMnOiAnYm9vbGVhbicsXG4gICdudXRyaXRpb25faGVhdnlfZm9vZCc6ICdib29sZWFuJyxcbiAgJ251dHJpdGlvbl9mYXN0X2Zvb2QnOiAnYm9vbGVhbicsXG4gICdudXRyaXRpb25feW9ndXJ0JzogJ2Jvb2xlYW4nLFxuICAnbGlmZV9jb3VwbGVfZGlzY3Vzc2lvbnMnOiAnc2xpZGVyJyxcbiAgJ2xpZmVfZ2FtaW5nJzogJ2Jvb2xlYW4nLFxuICAnbm90ZXMnOiAndGV4dCdcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVGaWVsZChkYXRlOiBzdHJpbmcsIHNlY3Rpb25JZDogc3RyaW5nLCBmaWVsZElkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuKSB7XG4gIHJldHVybiB3aXRoUmV0cnkoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRvYyA9IGF3YWl0IGdldFNwcmVhZHNoZWV0Q29ubmVjdGlvbigpO1xuICAgIGNvbnN0IHNoZWV0ID0gZG9jLnNoZWV0c0J5SW5kZXhbMF07XG4gICAgXG4gICAgLy8gVW5hIHNvbGEgbGVjdHVyYSBwYXJhIGVuY29udHJhciBvIGNyZWFyIGxhIGZpbGFcbiAgICBjb25zdCByb3dzID0gYXdhaXQgc2hlZXQuZ2V0Um93cygpO1xuICAgIGNvbnN0IHJvd0luZGV4ID0gcm93cy5maW5kSW5kZXgocm93ID0+IHJvdy5nZXQoJ2RhdGUnKSA9PT0gZGF0ZSk7XG4gICAgY29uc3QgZmllbGRLZXkgPSBgJHtzZWN0aW9uSWR9XyR7ZmllbGRJZH1gO1xuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChyb3dJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgLy8gU2kgbm8gZXhpc3RlIGxhIGZpbGEsIGxhIGNyZWFtb3MgY29uIFRPRE9TIGxvcyBjYW1wb3MgaW5pY2lhbGl6YWRvc1xuICAgICAgICBjb25zdCBuZXdSb3c6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7XG4gICAgICAgICAgZGF0ZSxcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIEluaWNpYWxpemFyIHRvZG9zIGxvcyBjYW1wb3MgY29uIHN1cyB2YWxvcmVzIHBvciBkZWZlY3RvIHNlZ8O6biBzdSB0aXBvXG4gICAgICAgIEhFQURFUlMuZm9yRWFjaChoZWFkZXIgPT4ge1xuICAgICAgICAgIGlmIChoZWFkZXIgPT09ICdkYXRlJykgcmV0dXJuOyAvLyBTa2lwIGRhdGUgYXMgaXQncyBhbHJlYWR5IHNldFxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGZpZWxkVHlwZSA9IEZJRUxEX1RZUEVTW2hlYWRlcl07XG4gICAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICdGQUxTRSc7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWludXRlcyc6XG4gICAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gJzAnO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3NsaWRlcic6XG4gICAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gJzEnO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcnO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQWN0dWFsaXphciBlbCBjYW1wbyBlc3BlY8OtZmljbyBjb24gZWwgdmFsb3IgcHJvcG9yY2lvbmFkb1xuICAgICAgICBuZXdSb3dbZmllbGRLZXldID0gdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgPyB2YWx1ZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkgOiB2YWx1ZS50b1N0cmluZygpO1xuICAgICAgICBcbiAgICAgICAgLy8gU29sbyB1bmEgZXNjcml0dXJhIHBhcmEgY3JlYXIgbGEgZmlsYVxuICAgICAgICBhd2FpdCBzaGVldC5hZGRSb3cobmV3Um93KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNpIGV4aXN0ZSwgYWN0dWFsaXphbW9zIHNvbG8gZWwgY2FtcG8gZXNwZWPDrWZpY29cbiAgICAgICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJyA/IHZhbHVlLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKSA6IHZhbHVlLnRvU3RyaW5nKCk7XG4gICAgICAgIHJvd3Nbcm93SW5kZXhdLnNldChmaWVsZEtleSwgZm9ybWF0dGVkVmFsdWUpO1xuICAgICAgICBcbiAgICAgICAgLy8gU29sbyB1bmEgZXNjcml0dXJhIHBhcmEgYWN0dWFsaXphciBlbCBjYW1wb1xuICAgICAgICBhd2FpdCByb3dzW3Jvd0luZGV4XS5zYXZlKCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHVwZGF0ZUZpZWxkIG9wZXJhdGlvbjonLCB7XG4gICAgICAgIGVycm9yLFxuICAgICAgICBkYXRlLFxuICAgICAgICBzZWN0aW9uSWQsXG4gICAgICAgIGZpZWxkSWQsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICBmaWVsZEtleVxuICAgICAgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlTm90ZXMoZGF0ZTogc3RyaW5nLCBub3Rlczogc3RyaW5nKSB7XG4gIHJldHVybiB3aXRoUmV0cnkoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRvYyA9IGF3YWl0IGdldFNwcmVhZHNoZWV0Q29ubmVjdGlvbigpO1xuICAgIGNvbnN0IHNoZWV0ID0gZG9jLnNoZWV0c0J5SW5kZXhbMF07XG4gICAgXG4gICAgY29uc3Qgcm93cyA9IGF3YWl0IHNoZWV0LmdldFJvd3MoKTtcbiAgICBjb25zdCByb3dJbmRleCA9IHJvd3MuZmluZEluZGV4KHJvdyA9PiByb3cuZ2V0KCdkYXRlJykgPT09IGRhdGUpO1xuICAgIFxuICAgIGlmIChyb3dJbmRleCA9PT0gLTEpIHtcbiAgICAgIC8vIFNpIG5vIGV4aXN0ZSBsYSBmaWxhLCBsYSBjcmVhbW9zIGNvbiBUT0RPUyBsb3MgY2FtcG9zIGluaWNpYWxpemFkb3NcbiAgICAgIGNvbnN0IG5ld1JvdzogUmVjb3JkPHN0cmluZywgYW55PiA9IHtcbiAgICAgICAgZGF0ZSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIEluaWNpYWxpemFyIHRvZG9zIGxvcyBjYW1wb3MgY29uIHN1cyB2YWxvcmVzIHBvciBkZWZlY3RvIHNlZ8O6biBzdSB0aXBvXG4gICAgICBIRUFERVJTLmZvckVhY2goaGVhZGVyID0+IHtcbiAgICAgICAgaWYgKGhlYWRlciA9PT0gJ2RhdGUnKSByZXR1cm47IC8vIFNraXAgZGF0ZSBhcyBpdCdzIGFscmVhZHkgc2V0XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSBGSUVMRF9UWVBFU1toZWFkZXJdO1xuICAgICAgICBzd2l0Y2ggKGZpZWxkVHlwZSkge1xuICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnRkFMU0UnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnbWludXRlcyc6XG4gICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcwJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NsaWRlcic6XG4gICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcxJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSBoZWFkZXIgPT09ICdub3RlcycgPyBub3RlcyA6ICcnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBzaGVldC5hZGRSb3cobmV3Um93KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcm93c1tyb3dJbmRleF0uc2V0KCdub3RlcycsIG5vdGVzKTtcbiAgICAgIGF3YWl0IHJvd3Nbcm93SW5kZXhdLnNhdmUoKTtcbiAgICB9XG4gIH0pO1xufVxuXG5pbnRlcmZhY2UgRGF5RGF0YSB7XG4gIFtrZXk6IHN0cmluZ106IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW47XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbnN1cmVBbmRMb2FkRGF5KGRhdGU6IHN0cmluZyk6IFByb21pc2U8RGF5RGF0YSB8IG51bGw+IHtcbiAgcmV0dXJuIHdpdGhSZXRyeShhc3luYyAoKSA9PiB7XG4gICAgLy8gVmVyaWZpY2FyIGNhY2hlXG4gICAgaWYgKFJPV19DQUNIRVtkYXRlXSAmJiAoRGF0ZS5ub3coKSAtIFJPV19DQUNIRVtkYXRlXS50aW1lc3RhbXApIDwgQ0FDSEVfVFRMKSB7XG4gICAgICByZXR1cm4gUk9XX0NBQ0hFW2RhdGVdLmRhdGE7XG4gICAgfVxuXG4gICAgY29uc3QgZG9jID0gYXdhaXQgZ2V0U3ByZWFkc2hlZXRDb25uZWN0aW9uKCk7XG4gICAgY29uc3Qgc2hlZXQgPSBkb2Muc2hlZXRzQnlJbmRleFswXTtcbiAgICBcbiAgICAvLyBVbmEgc29sYSBsZWN0dXJhIHBhcmEgb2J0ZW5lci9jcmVhciBsb3MgZGF0b3MgZGVsIGTDrWFcbiAgICBjb25zdCByb3dzID0gYXdhaXQgZ2V0U2hlZXRSb3dzKHNoZWV0KTtcbiAgICBsZXQgcm93ID0gcm93cy5maW5kKHJvdyA9PiByb3cuZ2V0KCdkYXRlJykgPT09IGRhdGUpO1xuICAgIFxuICAgIGlmICghcm93KSB7XG4gICAgICAvLyBDcmVhciBsYSBmaWxhIGNvbiB2YWxvcmVzIHBvciBkZWZlY3RvXG4gICAgICBjb25zdCBuZXdSb3c6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7XG4gICAgICAgIGRhdGUsXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBJbmljaWFsaXphciB0b2RvcyBsb3MgY2FtcG9zIGNvbiBzdXMgdmFsb3JlcyBwb3IgZGVmZWN0b1xuICAgICAgSEVBREVSUy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgIGlmIChoZWFkZXIgPT09ICdkYXRlJykgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZmllbGRUeXBlID0gRklFTERfVFlQRVNbaGVhZGVyXTtcbiAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHtcbiAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gJ0ZBTFNFJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ21pbnV0ZXMnOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnMCc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzbGlkZXInOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnMSc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgICAgIG5ld1Jvd1toZWFkZXJdID0gJyc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJvdyA9IGF3YWl0IHNoZWV0LmFkZFJvdyhuZXdSb3cpO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGE6IERheURhdGEgPSB7fTtcbiAgICBIRUFERVJTLmZvckVhY2goaGVhZGVyID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcm93LmdldChoZWFkZXIpO1xuICAgICAgXG4gICAgICBpZiAoaGVhZGVyID09PSAnbm90ZXMnKSB7XG4gICAgICAgIGRhdGFbaGVhZGVyXSA9IHZhbHVlIHx8ICcnO1xuICAgICAgfSBlbHNlIGlmIChoZWFkZXIgPT09ICdkYXRlJykge1xuICAgICAgICBkYXRhW2hlYWRlcl0gPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gJ1RSVUUnIHx8IHZhbHVlID09PSAndHJ1ZScpIHtcbiAgICAgICAgICBkYXRhW2hlYWRlcl0gPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAnRkFMU0UnIHx8IHZhbHVlID09PSAnZmFsc2UnKSB7XG4gICAgICAgICAgZGF0YVtoZWFkZXJdID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKE51bWJlcih2YWx1ZSkpICYmIHZhbHVlICE9PSAnJykge1xuICAgICAgICAgIGRhdGFbaGVhZGVyXSA9IE51bWJlcih2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGF0YVtoZWFkZXJdID0gdmFsdWUgfHwgJyc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEd1YXJkYXIgZW4gY2FjaGVcbiAgICBST1dfQ0FDSEVbZGF0ZV0gPSB7XG4gICAgICBkYXRhLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gZGF0YTtcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbnN1cmVEYXlFeGlzdHMoZGF0ZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiB3aXRoUmV0cnkoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRvYyA9IGF3YWl0IGdldFNwcmVhZHNoZWV0Q29ubmVjdGlvbigpO1xuICAgIGNvbnN0IHNoZWV0ID0gZG9jLnNoZWV0c0J5SW5kZXhbMF07XG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIHNpIHlhIGV4aXN0ZSBsYSBmaWxhXG4gICAgY29uc3Qgcm93cyA9IGF3YWl0IHNoZWV0LmdldFJvd3MoKTtcbiAgICBjb25zdCByb3dFeGlzdHMgPSByb3dzLnNvbWUocm93ID0+IHJvdy5nZXQoJ2RhdGUnKSA9PT0gZGF0ZSk7XG4gICAgXG4gICAgaWYgKCFyb3dFeGlzdHMpIHtcbiAgICAgIC8vIENyZWFyIGxhIGZpbGEgY29uIHZhbG9yZXMgcG9yIGRlZmVjdG9cbiAgICAgIGNvbnN0IG5ld1JvdzogUmVjb3JkPHN0cmluZywgYW55PiA9IHtcbiAgICAgICAgZGF0ZSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIEluaWNpYWxpemFyIHRvZG9zIGxvcyBjYW1wb3MgY29uIHN1cyB2YWxvcmVzIHBvciBkZWZlY3RvXG4gICAgICBIRUFERVJTLmZvckVhY2goaGVhZGVyID0+IHtcbiAgICAgICAgaWYgKGhlYWRlciA9PT0gJ2RhdGUnKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSBGSUVMRF9UWVBFU1toZWFkZXJdO1xuICAgICAgICBzd2l0Y2ggKGZpZWxkVHlwZSkge1xuICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnRkFMU0UnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnbWludXRlcyc6XG4gICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcwJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3NsaWRlcic6XG4gICAgICAgICAgICBuZXdSb3dbaGVhZGVyXSA9ICcxJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICAgICAgbmV3Um93W2hlYWRlcl0gPSAnJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2hlZXQuYWRkUm93KG5ld1Jvdyk7XG4gICAgfVxuICB9KTtcbn0gIl0sIm5hbWVzIjpbIkdvb2dsZVNwcmVhZHNoZWV0IiwiSldUIiwiTUFYX1JFVFJJRVMiLCJSRVRSWV9ERUxBWSIsIk9QRVJBVElPTl9USU1FT1VUIiwiUkFURV9MSU1JVF9ERUxBWSIsImNhY2hlZERvYyIsImxhc3RSZXF1ZXN0VGltZSIsImNhY2hlZFJvd3MiLCJsYXN0Um93c0ZldGNoIiwiQ0FDSEVfVFRMIiwiUk9XX0NBQ0hFIiwid2FpdEZvclJhdGVMaW1pdCIsIm5vdyIsIkRhdGUiLCJ0aW1lU2luY2VMYXN0UmVxdWVzdCIsIndhaXQiLCJlbnN1cmVIZWFkZXJzIiwic2hlZXQiLCJsb2FkSGVhZGVyUm93IiwiaGVhZGVyVmFsdWVzIiwibWlzc2luZ0hlYWRlcnMiLCJIRUFERVJTIiwiZmlsdGVyIiwiaGVhZGVyIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJjb25zb2xlIiwibG9nIiwidG90YWxDb2x1bW5zIiwiY29sdW1uQ291bnQiLCJyZXNpemUiLCJuZXdIZWFkZXJzIiwic2V0SGVhZGVyUm93IiwiZXJyb3IiLCJnZXRTcHJlYWRzaGVldENvbm5lY3Rpb24iLCJsb2FkSW5mbyIsIlNDT1BFUyIsImp3dCIsImVtYWlsIiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9TSEVFVFNfQ0xJRU5UX0VNQUlMIiwia2V5IiwiR09PR0xFX1NIRUVUU19QUklWQVRFX0tFWSIsInJlcGxhY2UiLCJzY29wZXMiLCJkb2MiLCJHT09HTEVfU0hFRVRTX1NQUkVBRFNIRUVUX0lEIiwic2hlZXRzQnlJbmRleCIsImdldFNoZWV0Um93cyIsImdldFJvd3MiLCJtcyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsIndpdGhUaW1lb3V0Iiwib3BlcmF0aW9uIiwidGltZW91dFByb21pc2UiLCJfIiwicmVqZWN0IiwiRXJyb3IiLCJyYWNlIiwid2l0aFJldHJ5IiwibGFzdEVycm9yIiwiYXR0ZW1wdCIsImRlbGF5Iiwic3RhdHVzIiwiTWF0aCIsInBvdyIsIkZJRUxEX1RZUEVTIiwidXBkYXRlRmllbGQiLCJkYXRlIiwic2VjdGlvbklkIiwiZmllbGRJZCIsInZhbHVlIiwicm93cyIsInJvd0luZGV4IiwiZmluZEluZGV4Iiwicm93IiwiZ2V0IiwiZmllbGRLZXkiLCJuZXdSb3ciLCJmb3JFYWNoIiwiZmllbGRUeXBlIiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsImFkZFJvdyIsImZvcm1hdHRlZFZhbHVlIiwic2V0Iiwic2F2ZSIsInVwZGF0ZU5vdGVzIiwibm90ZXMiLCJlbnN1cmVBbmRMb2FkRGF5IiwidGltZXN0YW1wIiwiZGF0YSIsImZpbmQiLCJpc05hTiIsIk51bWJlciIsImVuc3VyZURheUV4aXN0cyIsInJvd0V4aXN0cyIsInNvbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/lib/spreadsheet.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/load-data/route.ts":
/*!****************************************!*\
  !*** ./src/app/api/load-data/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var _lib_spreadsheet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/spreadsheet */ \"(rsc)/./src/app/api/lib/spreadsheet.ts\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\n\nasync function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const date = searchParams.get(\"date\");\n        if (!date) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: \"Date parameter is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Verificar que las variables de entorno estén definidas\n        const requiredEnvVars = [\n            \"GOOGLE_SHEETS_PRIVATE_KEY\",\n            \"GOOGLE_SHEETS_CLIENT_EMAIL\",\n            \"GOOGLE_SHEETS_SPREADSHEET_ID\"\n        ];\n        const missingEnvVars = requiredEnvVars.filter((varName)=>!process.env[varName]);\n        if (missingEnvVars.length > 0) {\n            console.error(\"Missing environment variables:\", missingEnvVars);\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: \"Configuration error\",\n                details: `Missing environment variables: ${missingEnvVars.join(\", \")}`\n            }, {\n                status: 500\n            });\n        }\n        // Log de las variables de entorno (sin mostrar valores completos por seguridad)\n        console.log(\"Environment variables status:\", {\n            PRIVATE_KEY: process.env.GOOGLE_SHEETS_PRIVATE_KEY?.slice(0, 20) + \"...\",\n            CLIENT_EMAIL: process.env.GOOGLE_SHEETS_CLIENT_EMAIL?.slice(0, 10) + \"...\",\n            SPREADSHEET_ID: process.env.GOOGLE_SHEETS_SPREADSHEET_ID?.slice(0, 10) + \"...\"\n        });\n        const data = await (0,_lib_spreadsheet__WEBPACK_IMPORTED_MODULE_0__.loadDayData)(date);\n        if (!data) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: \"No data found\",\n                details: `No data found for date: ${date}`\n            }, {\n                status: 404\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json(data);\n    } catch (error) {\n        console.error(\"Load data error:\", error);\n        // Mejorar el mensaje de error\n        const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n        const errorStack = error instanceof Error ? error.stack : undefined;\n        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: \"Failed to load data\",\n            details: errorMessage,\n            stack:  true ? errorStack : 0,\n            timestamp: new Date().toISOString()\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9sb2FkLWRhdGEvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWlEO0FBQ047QUFFcEMsZUFBZUUsSUFBSUMsT0FBZ0I7SUFDeEMsSUFBSTtRQUNGLE1BQU0sRUFBRUMsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSUYsUUFBUUcsR0FBRztRQUM1QyxNQUFNQyxPQUFPSCxhQUFhSSxHQUFHLENBQUM7UUFFOUIsSUFBSSxDQUFDRCxNQUFNO1lBQ1QsT0FBT04scURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUE2QixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDbEY7UUFFQSx5REFBeUQ7UUFDekQsTUFBTUMsa0JBQWtCO1lBQ3RCO1lBQ0E7WUFDQTtTQUNEO1FBRUQsTUFBTUMsaUJBQWlCRCxnQkFBZ0JFLE1BQU0sQ0FBQ0MsQ0FBQUEsVUFBVyxDQUFDQyxRQUFRQyxHQUFHLENBQUNGLFFBQVE7UUFDOUUsSUFBSUYsZUFBZUssTUFBTSxHQUFHLEdBQUc7WUFDN0JDLFFBQVFULEtBQUssQ0FBQyxrQ0FBa0NHO1lBQ2hELE9BQU9aLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7Z0JBQ3ZCQyxPQUFPO2dCQUNQVSxTQUFTLENBQUMsK0JBQStCLEVBQUVQLGVBQWVRLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDeEUsR0FBRztnQkFBRVYsUUFBUTtZQUFJO1FBQ25CO1FBRUEsZ0ZBQWdGO1FBQ2hGUSxRQUFRRyxHQUFHLENBQUMsaUNBQWlDO1lBQzNDQyxhQUFhUCxRQUFRQyxHQUFHLENBQUNPLHlCQUF5QixFQUFFQyxNQUFNLEdBQUcsTUFBTTtZQUNuRUMsY0FBY1YsUUFBUUMsR0FBRyxDQUFDVSwwQkFBMEIsRUFBRUYsTUFBTSxHQUFHLE1BQU07WUFDckVHLGdCQUFnQlosUUFBUUMsR0FBRyxDQUFDWSw0QkFBNEIsRUFBRUosTUFBTSxHQUFHLE1BQU07UUFDM0U7UUFFQSxNQUFNSyxPQUFPLE1BQU05Qiw2REFBV0EsQ0FBQ087UUFFL0IsSUFBSSxDQUFDdUIsTUFBTTtZQUNULE9BQU83QixxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO2dCQUN2QkMsT0FBTztnQkFDUFUsU0FBUyxDQUFDLHdCQUF3QixFQUFFYixLQUFLLENBQUM7WUFDNUMsR0FBRztnQkFBRUksUUFBUTtZQUFJO1FBQ25CO1FBRUEsT0FBT1YscURBQVlBLENBQUNRLElBQUksQ0FBQ3FCO0lBQzNCLEVBQUUsT0FBT3BCLE9BQU87UUFDZFMsUUFBUVQsS0FBSyxDQUFDLG9CQUFvQkE7UUFFbEMsOEJBQThCO1FBQzlCLE1BQU1xQixlQUFlckIsaUJBQWlCc0IsUUFBUXRCLE1BQU11QixPQUFPLEdBQUc7UUFDOUQsTUFBTUMsYUFBYXhCLGlCQUFpQnNCLFFBQVF0QixNQUFNeUIsS0FBSyxHQUFHQztRQUUxRCxPQUFPbkMscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUN2QkMsT0FBTztZQUNQVSxTQUFTVztZQUNUSSxPQUFPbkIsS0FBeUIsR0FBZ0JrQixhQUFhRSxDQUFTQTtZQUN0RUMsV0FBVyxJQUFJQyxPQUFPQyxXQUFXO1FBQ25DLEdBQUc7WUFBRTVCLFFBQVE7UUFBSTtJQUNuQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGFpbHktcmV2aWV3Ly4vc3JjL2FwcC9hcGkvbG9hZC1kYXRhL3JvdXRlLnRzP2Y5NDAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9hZERheURhdGEgfSBmcm9tICcuLi9saWIvc3ByZWFkc2hlZXQnO1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgZGF0ZSA9IHNlYXJjaFBhcmFtcy5nZXQoJ2RhdGUnKTtcblxuICAgIGlmICghZGF0ZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdEYXRlIHBhcmFtZXRlciBpcyByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgcXVlIGxhcyB2YXJpYWJsZXMgZGUgZW50b3JubyBlc3TDqW4gZGVmaW5pZGFzXG4gICAgY29uc3QgcmVxdWlyZWRFbnZWYXJzID0gW1xuICAgICAgJ0dPT0dMRV9TSEVFVFNfUFJJVkFURV9LRVknLFxuICAgICAgJ0dPT0dMRV9TSEVFVFNfQ0xJRU5UX0VNQUlMJyxcbiAgICAgICdHT09HTEVfU0hFRVRTX1NQUkVBRFNIRUVUX0lEJ1xuICAgIF07XG5cbiAgICBjb25zdCBtaXNzaW5nRW52VmFycyA9IHJlcXVpcmVkRW52VmFycy5maWx0ZXIodmFyTmFtZSA9PiAhcHJvY2Vzcy5lbnZbdmFyTmFtZV0pO1xuICAgIGlmIChtaXNzaW5nRW52VmFycy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNaXNzaW5nIGVudmlyb25tZW50IHZhcmlhYmxlczonLCBtaXNzaW5nRW52VmFycyk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0NvbmZpZ3VyYXRpb24gZXJyb3InLFxuICAgICAgICBkZXRhaWxzOiBgTWlzc2luZyBlbnZpcm9ubWVudCB2YXJpYWJsZXM6ICR7bWlzc2luZ0VudlZhcnMuam9pbignLCAnKX1gXG4gICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIC8vIExvZyBkZSBsYXMgdmFyaWFibGVzIGRlIGVudG9ybm8gKHNpbiBtb3N0cmFyIHZhbG9yZXMgY29tcGxldG9zIHBvciBzZWd1cmlkYWQpXG4gICAgY29uc29sZS5sb2coJ0Vudmlyb25tZW50IHZhcmlhYmxlcyBzdGF0dXM6Jywge1xuICAgICAgUFJJVkFURV9LRVk6IHByb2Nlc3MuZW52LkdPT0dMRV9TSEVFVFNfUFJJVkFURV9LRVk/LnNsaWNlKDAsIDIwKSArICcuLi4nLFxuICAgICAgQ0xJRU5UX0VNQUlMOiBwcm9jZXNzLmVudi5HT09HTEVfU0hFRVRTX0NMSUVOVF9FTUFJTD8uc2xpY2UoMCwgMTApICsgJy4uLicsXG4gICAgICBTUFJFQURTSEVFVF9JRDogcHJvY2Vzcy5lbnYuR09PR0xFX1NIRUVUU19TUFJFQURTSEVFVF9JRD8uc2xpY2UoMCwgMTApICsgJy4uLidcbiAgICB9KTtcblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBsb2FkRGF5RGF0YShkYXRlKTtcbiAgICBcbiAgICBpZiAoIWRhdGEpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxuICAgICAgICBlcnJvcjogJ05vIGRhdGEgZm91bmQnLFxuICAgICAgICBkZXRhaWxzOiBgTm8gZGF0YSBmb3VuZCBmb3IgZGF0ZTogJHtkYXRlfWBcbiAgICAgIH0sIHsgc3RhdHVzOiA0MDQgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGRhdGEpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0xvYWQgZGF0YSBlcnJvcjonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gTWVqb3JhciBlbCBtZW5zYWplIGRlIGVycm9yXG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcic7XG4gICAgY29uc3QgZXJyb3JTdGFjayA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBsb2FkIGRhdGEnLFxuICAgICAgZGV0YWlsczogZXJyb3JNZXNzYWdlLFxuICAgICAgc3RhY2s6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyb3JTdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufSAiXSwibmFtZXMiOlsibG9hZERheURhdGEiLCJOZXh0UmVzcG9uc2UiLCJHRVQiLCJyZXF1ZXN0Iiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwiZGF0ZSIsImdldCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsInJlcXVpcmVkRW52VmFycyIsIm1pc3NpbmdFbnZWYXJzIiwiZmlsdGVyIiwidmFyTmFtZSIsInByb2Nlc3MiLCJlbnYiLCJsZW5ndGgiLCJjb25zb2xlIiwiZGV0YWlscyIsImpvaW4iLCJsb2ciLCJQUklWQVRFX0tFWSIsIkdPT0dMRV9TSEVFVFNfUFJJVkFURV9LRVkiLCJzbGljZSIsIkNMSUVOVF9FTUFJTCIsIkdPT0dMRV9TSEVFVFNfQ0xJRU5UX0VNQUlMIiwiU1BSRUFEU0hFRVRfSUQiLCJHT09HTEVfU0hFRVRTX1NQUkVBRFNIRUVUX0lEIiwiZGF0YSIsImVycm9yTWVzc2FnZSIsIkVycm9yIiwibWVzc2FnZSIsImVycm9yU3RhY2siLCJzdGFjayIsInVuZGVmaW5lZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/load-data/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/lodash","vendor-chunks/google-auth-library","vendor-chunks/tr46","vendor-chunks/mime-db","vendor-chunks/axios","vendor-chunks/bignumber.js","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/gaxios","vendor-chunks/google-spreadsheet","vendor-chunks/json-bigint","vendor-chunks/follow-redirects","vendor-chunks/google-logging-utils","vendor-chunks/gcp-metadata","vendor-chunks/debug","vendor-chunks/form-data","vendor-chunks/https-proxy-agent","vendor-chunks/gtoken","vendor-chunks/uuid","vendor-chunks/agent-base","vendor-chunks/asynckit","vendor-chunks/jws","vendor-chunks/jwa","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/webidl-conversions","vendor-chunks/combined-stream","vendor-chunks/base64-js","vendor-chunks/mime-types","vendor-chunks/proxy-from-env","vendor-chunks/extend","vendor-chunks/ms","vendor-chunks/supports-color","vendor-chunks/delayed-stream","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time","vendor-chunks/is-stream","vendor-chunks/has-flag"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fload-data%2Froute&page=%2Fapi%2Fload-data%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fload-data%2Froute.ts&appDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ffedericocaccia%2Fcode%2Fdaily-review&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();